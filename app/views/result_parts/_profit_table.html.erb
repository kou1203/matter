<% days = ["日", "月", "火", "水", "木", "金", "土"] %>
      <% shifts = @shifts.where(user_id: @results.first.user_id).where(start_time: @results.minimum(:date)..@results.minimum(:date).next_month.ago(1.days)) %>
  <%# 個別利益表 %>
    <h1>表示範囲：<%= @results.minimum(:date) %>（<%= days[@results.minimum(:date).wday] %>）〜<%= @results.maximum(:date) %>（<%= days[@results.maximum(:date).wday] %>）</h1>
  <%# 初期値変数 %>
    <%# シフト %>
        <% new_shift = 0 %>
        <% settlement_shift = 0 %>
        <% summit_shift = 0 %>
        <% casa_shift = 0 %>
        <% casa_put_shift = 0 %>
        <% panda_shift = 0 %>
        <% ojt_shift = 0 %>
        <% house_work_shift = 0 %>
        <% new_shift = shifts.where(shift: "キャッシュレス新規").length %>
        <% settlement_shift = shifts.where(shift: "キャッシュレス決済").length %>
        <% summit_shift = shifts.where(shift: "サミット").length %>
        <% casa_shift = shifts.where(shift: "楽天フェムト新規").length %>
        <% casa_put_shift= shifts.where(shift: "楽天フェムト").length %>
        <% ojt_shift = shifts.where(shift: "帯同").length %>
        <% house_work_shift = shifts.where(shift: "内勤").length %> 

      <h1>拠点：<%= @results.first.user.base %><%= @results.first.user.base_sub %><%= @results.first.user.name %></h1>
  <%# シフト %>
  <% if shifts.blank? %>
    <h1 class="warning">予定シフトがありません。シフト申請を行ってください</h1>
  <% else %>
  <h2 class="shift-h2">予定シフト：<%= shifts.minimum(:start_time).strftime('%Y-%m-%d') %>（<%= days[shifts.minimum(:start_time).wday] %>）〜<%= shifts.maximum(:start_time).strftime('%Y-%m-%d') %>（<%= days[shifts.maximum(:start_time).wday] %>）</h2>
  <% end %>
    <table>
      <tr>
        <th class="shift-th">シフト（内訳）</th>
        <th class="shift-th">予定</th>
        <th class="shift-th">消化</th>
        <th class="shift-th">残シフト</th>
        <th class="shift-th">欠勤</th>
      </tr>
      <tr>
        <td >キャッシュレス新規</td><%# 欠勤 %>
        <td ><%= new_shift %></td>
        <td ><%= digestion_new = @results.where(shift: "キャッシュレス新規").length %></td>
        <td ><%= new_shift - digestion_new %></td>
        <td style="color:red; font-weight:bold;"><%= absence = @results.where(shift: "欠勤").length %></td>
      </tr>
      <tr>
        <td >キャッシュレス決済</td>
        <td ><%= settlement_shift %></td>
        <td ><%= digestion_settlement = @results.where(shift: "キャッシュレス決済").length %></td>
        <td ><%= settlement_shift - digestion_settlement %></td>
      </tr>
      <tr>
        <td>サミット</td>
        <td ><%= summit_shift %></td>
        <td ><%= digestion_summit = @results.where(shift: "サミット").length %></td>
        <td ><%= summit_shift - digestion_summit %></td>
      </tr>
      <tr>
        <td>パンダ</td>
        <td ><%= panda_shift %></td>
        <td ><%= digestion_panda = @results.where(shift: "パンダ").length %></td>
        <td ><%= panda_shift - digestion_panda %></td>
      </tr>
      <tr>
        <td>楽天フェムト新規</td>
        <td ><%= casa_shift %></td>
        <td ><%= digestion_casa = @results.where(shift: "楽天フェムト新規").length %></td>
        <td ><%= casa_shift - digestion_casa %></td>
      </tr>
      <tr>
        <td>楽天フェムト設置</td>
        <td ><%= casa_put_shift %></td>
        <td ><%= digestion_casa_put = @results.where(shift: "楽天フェムト設置").length %></td>
        <td ><%= casa_put_shift - digestion_casa_put %></td>
      </tr>
      <tr>
        <td>帯同</td>
        <td ><%= ojt_shift %></td>
        <td ><%= digestion_ojt = @results.where(shift: "帯同").length %></td>
        <td ><%= ojt_shift - digestion_ojt %></td>
      </tr>
      <tr>
        <td>内勤</td>
        <td ><%= house_work_shift %></td>
        <td ><%= digestion_house_work = @results.where(shift: "内勤").length %></td>
        <td ><%= house_work_shift - digestion_house_work %></td>
      </tr>
      <tr>
        <td>合計</td>
        <td class="td-sum"><%= shift_sum = new_shift + settlement_shift + summit_shift + casa_shift + casa_put_shift + ojt_shift + house_work_shift %></td>
            <td ><%= digestion_sum = digestion_new + digestion_settlement + digestion_summit + digestion_panda + digestion_casa + digestion_casa_put + digestion_ojt + digestion_house_work + absence %></td>
        <td ><%= shift_sum - digestion_sum %></td>
      </tr>
    </table>

    <%# 商材（評価売上） %>
      <%# dメル %>
        <%# 新規 %>
          <% dmer_new_profit = @dmers_this_month.sum(:valuation_new) - @dmers_def_this_month.sum(:valuation_new) + @dmers_inc.sum(:valuation_new) %>
        <%# 決済 %>
          <% dmer_slmt_profit = @dmers_slmt_this_month.sum(:valuation_settlement) %>
      <%# aupay %>
        <%# 新規 %>
          <% aupay_new_profit = @aupays_this_month.sum(:valuation_new) %>
        <%# 決済 %>
          <% aupay_slmt_profit = @aupays_slmt_this_month.sum(:valuation_settlement) %>
      <%# PayPay %>
        <% paypay_profit =  @paypays_this_month.sum(:valuation) - @paypays_def_this_month.sum(:valuation) %>
      <%# 少額短期保険 %>
        <% st_insurance_profit = @st_insurances_this_month.sum(:valuation) - @st_insurances_def_this_month.sum(:valuation) %>
      <%# 楽天ペイ %>
          <% rakuten_pay_profit = @rakuten_pays_this_month.sum(:valuation) - @rakuten_pays_def_this_month.sum(:valuation) + @rakuten_pays_inc.sum(:valuation)  %>
      <%# フェムト新規 %>
        <% casa_new_profit = @rakuten_casas_this_month.sum(:valuation_new) - @rakuten_casas_def_this_month.sum(:valuation_new) + @rakuten_casas_inc.sum(:valuation_new) %>
      <%# フェムト設置 %>
        <% casa_put_profit = (@rakuten_casas_put_self.sum(:valuation_put) + (@rakuten_casas_put_other.sum(:valuation_put) * 0.8) + (@rakuten_casas_put_request.sum(:valuation_put) * 0.3)).to_i %>
      <%# 合計売上 %>
        <% sum_profit_new = dmer_new_profit + aupay_new_profit + paypay_profit + st_insurance_profit + rakuten_pay_profit %>
        <% sum_profit_slmt = dmer_slmt_profit +  aupay_slmt_profit %>
        <% sum_profit = casa_new_profit + casa_put_profit %>
      <%# 平均売上 %>
        <% ave_profit_new = sum_profit_new.to_f / digestion_new %>
        <% ave_profit_slmt = sum_profit_slmt.to_f / digestion_settlement %>
        <% ave_profit = (sum_profit.to_f / @results.where.not(shift: "休み").where.not(shift: "帯同").where.not(shift: "内勤").where.not(shift: "欠勤").length) %>
  <h1>獲得商材内訳</h1>
    <h2>売上</h2>
    <table>
      <tr>
        <th>dメル（新規）</th>
        <th>dメル（決済）</th>
        <th>aupay（新規）</th>
        <th>aupay（決済）</th>
        <th>PayPay</th>
        <th>楽天ペイ</th>
        <th>フェムト（新規）</th>
        <th>フェムト（設置）</th>
        <th>平均売上（新規）</th>
        <th>平均売上（決済）</th>
        <th>現状売上</th>
        <th>終着見込売上</th><%# （平均売上 * 予定シフト数） %>
      </tr>
      <tr>
        <td><%= dmer_new_profit.to_s(:delimited) %></td>
        <td><%= dmer_slmt_profit.to_s(:delimited) %></td>
        <td><%= aupay_new_profit.to_s(:delimited) %></td>
        <td><%= aupay_slmt_profit.to_s(:delimited) %></td>
        <td><%= paypay_profit.to_s(:delimited) %></td>
        <td><%= rakuten_pay_profit.to_s(:delimited) %></td>
        <td><%= casa_new_profit.to_s(:delimited) %></td>
        <td><%= casa_put_profit.to_s(:delimited) %></td>
        <td><%= ave_profit_new.round().to_s(:delimited) rescue "計算不可" %></td>
        <td><%= ave_profit_slmt.round().to_s(:delimited) rescue "計算不可" %></td>
        
        <td><%= (sum_profit_new + sum_profit_slmt).to_s(:delimited) %></td>
        <td><%= (ave_profit_new * new_shift + ave_profit_slmt * settlement_shift).round().to_s(:delimited) rescue "計算不可" %></td>
      </tr>
    </table>
    <h2>獲得数</h2>
    <table>
      <tr>
      </tr>
      <tr>
        <th colspan="3">dメル（新規）</th>
        <th colspan="">dメル（決済）</th>
        <th colspan="3">aupay（新規）</th>
        <th colspan="">aupay（決済）</th>
        <th colspan="2">PayPay</th>
        <th colspan="2">少額短期保険</th>
        <th colspan="3">楽天ペイ</th>
        <th colspan="4">フェムト（新規）</th>
        <th colspan="">フェムト（設置）</th>
        <th colspan="">フェムト（他者設置）</th>
        <th colspan="">フェムト（設置依頼）</th>
      </tr>
      <tr></tr>
      <tr>
      </tr>
        <% 2.times do %>
        <th colspan="3" style="border-left: 1px solid rgb(214, 219, 235);">評価対象</th>
        <th colspan="" style="border-left: 1px solid rgb(214, 219, 235);">評価対象</th>
        <% end %>
        <% 2.times do %>
        <th colspan="2" style="border-left: 1px solid rgb(214, 219, 235);">評価対象</th>
        <% end %>
        <th colspan="3" style="border-left: 1px solid rgb(214, 219, 235);">評価対象</th>
        <th colspan="4" style="border-left: 1px solid rgb(214, 219, 235);">評価対象</th>
        <% 3.times do %>
        <th colspan="" style="border-left: 1px solid rgb(214, 219, 235);">評価対象</th>
        <% end %>
      <tr>
        <td colspan="3"><%= @dmers_this_month.length - @dmers_def_this_month.length + @dmers_inc.length %></td>
        <td colspan=""><%= @dmers_slmt_this_month.length %></td>
        <td colspan="3"><%= @aupays_this_month.length - @aupays_def_this_month.length + @aupays_inc.length %></td>
        <td colspan=""><%= @aupays_slmt_this_month.length %></td>
        <td colspan="2"><%= @paypays_this_month.length - @paypays_def_this_month.length %></td>
        <td colspan="2"><%= @st_insurances_this_month.length - @st_insurances_def_this_month.length %></td>
        <td colspan="3"><%= @rakuten_pays_this_month.length - @rakuten_pays_def_this_month.length %></td>
        <td colspan="4"><%= @rakuten_casas_this_month.length - @rakuten_casas_def_this_month.length + @rakuten_casas_inc.length %></td>
        <td colspan=""><%= @rakuten_casas_put_self.length %></td>
        <td colspan=""><%= @rakuten_casas_put_other.length %></td>
        <td colspan=""><%= @rakuten_casas_put_request.length %></td>
      </tr>
      <tr>
        
        <th>獲得数</th>
        <th>不備・NG</th>
        <th>増加数</th>
        <th>獲得数</th>
        <th>獲得数</th>
        <th>不備・NG</th>
        <th>増加数</th>
        <th>獲得数</th>
        
        <% 2.times do %>
        <th>獲得数</th>
        <th colspan="">不備・NG</th>
        <% end %>
        <% 2.times do %>
        <th>獲得数</th>
        <th>不備・NG</th>
        <th>増加数</th>
        <% end %>
      </tr>
      <tr>
        <%# dメル %>
          <td style="color: blue;"><%= @dmers_this_month.length  %></td>
          <td style="color: red;"><%= @dmers_def_this_month.length %></td>
          <td style="color: blue;"><%= @dmers_inc.length %></td>
          <td style="color: blue;"><%= @dmers_slmt_this_month.length %></td>

        <%# aupay %>
          <td style="color: blue;"><%= @aupays_this_month.length %></td>
          <td style="color: red;"><%= @aupays_def_this_month.length %></td>
          <td style="color: blue;"><%= @aupays_inc.length %></td>
          <td style="color: blue;"><%= @aupays_slmt_this_month.length %></td>
        <%# PayPay %>
          <td colspan="" style="color: blue;"><%= @paypays_this_month.length %></td>
          <td colspan="" style="color: red;"><%= @paypays_def_this_month.length %></td>
        <%# 少額短期保険 %>
          <td colspan="" style="color: blue;"><%= @st_insurances_this_month.length %></td>
          <td colspan="" style="color: red;"><%= @st_insurances_def_this_month.length %></td>
        <%# 楽天ペイ %>
          <td style="color: blue;"><%= @rakuten_pays_this_month.length  %></td>
          <td style="color: red;"><%= @rakuten_pays_def_this_month.length %></td>
          <td style="color: blue;"><%= @rakuten_pays_inc.length %></td>
        <%# 楽天フェムト新規 %>
          <td style="color: blue;"><%= @rakuten_casas_this_month.length %></td>
          <td style="color: red;"><%= @rakuten_casas_def_this_month.length %></td>
          <td style="color: blue;"><%= @rakuten_casas_inc.length %></td>
      </tr>
    </table>
  <h1>基準値</h1>
    <% if @results.where(shift: "キャッシュレス新規").empty? %>
    <% else %>
    <div style="display: flex;">
    <div>
  <h2>キャッシュレス新規</h2>
    <table>
    <tr>
    </tr>
      <tr>
        <th colspan="4">合計</th>
        <th colspan="4">前半</th>
        <th colspan="4">後半</th>
      </tr>
      <tr>
      <% 3.times do %>
        <th style="border-left: 1px solid rgb(214, 219, 235);">訪問</th>
        <th>対面</th>
        <th>フル</th>
        <th>成約</th>
      <% end %>
      </tr>
      <tr>
      <%# 合計 %>
        <td><%= (@results.where(shift: "キャッシュレス新規").sum("first_visit + latter_visit").to_f / @results.where(shift: "キャッシュレス新規").length).to_f().round(1) %></td>
        <td><%= (@results.where(shift: "キャッシュレス新規").sum("first_interview + latter_interview").to_f / @results.where(shift: "キャッシュレス新規").length).to_f().round(1) %></td>
        <td><%= (@results.where(shift: "キャッシュレス新規").sum("first_full_talk + latter_full_talk").to_f / @results.where(shift: "キャッシュレス新規").length).to_f().round(1) %></td>
        <td><%= (@results.where(shift: "キャッシュレス新規").sum("first_get + latter_get").to_f / @results.where(shift: "キャッシュレス新規").length).to_f().round(1) %></td>
      <%# 前半 %>
        <td><%= (@results.where(shift: "キャッシュレス新規").sum(:first_visit).to_f / @results.where(shift: "キャッシュレス新規").length).round(1) %></td>
        <td><%= (@results.where(shift: "キャッシュレス新規").sum(:first_interview).to_f / @results.where(shift: "キャッシュレス新規").length).round(1) %></td>
        <td><%= (@results.where(shift: "キャッシュレス新規").sum(:first_full_talk).to_f / @results.where(shift: "キャッシュレス新規").length).round(1) %></td>
        <td><%= (@results.where(shift: "キャッシュレス新規").sum(:first_get).to_f / @results.where(shift: "キャッシュレス新規").length).round(1) %></td>
      <%# 後半 %>
        <td><%= (@results.where(shift: "キャッシュレス新規").sum(:latter_visit).to_f / @results.where(shift: "キャッシュレス新規").length).round(1) %></td>
        <td><%= (@results.where(shift: "キャッシュレス新規").sum(:latter_interview).to_f / @results.where(shift: "キャッシュレス新規").length).round(1) %></td>
        <td><%= (@results.where(shift: "キャッシュレス新規").sum(:latter_full_talk).to_f / @results.where(shift: "キャッシュレス新規").length).round(1) %></td>
        <td><%= (@results.where(shift: "キャッシュレス新規").sum(:latter_get).to_f / @results.where(shift: "キャッシュレス新規").length).round(1) %></td>
      </tr>
    </table>

    </div>
    <div>
    <h2>店舗別基準値</h2>
    <table>
      <tr>
        <th colspan="2">喫茶・カフェ</th>
        <th colspan="2">その他飲食</th>
        <th colspan="2">車屋</th>
        <th colspan="2">その他小売</th>
        <th colspan="2">理容・美容</th>
        <th colspan="2">整体・鍼灸</th>
        <th colspan="2">その他サービス</th>
      </tr>
      <tr>
      <% 7.times do %>
        <th>訪問</th>
        <th>獲得</th>
      <% end %>
      </tr>
      <tr>
      </tr>
    <%# 店舗別基準値（値） %>
      <tr>
        <td><%= (@results.where(shift: "キャッシュレス新規").sum(:cafe_visit).to_f() / @results.where(shift: "キャッシュレス新規").length).round(1) %></td>
        <td><%= (@results.where(shift: "キャッシュレス新規").sum(:cafe_get).to_f() / @results.where(shift: "キャッシュレス新規").length).round(1) %></td>
        <td><%= (@results.where(shift: "キャッシュレス新規").sum(:other_food_visit).to_f() / @results.where(shift: "キャッシュレス新規").length).round(1) %></td>
        <td><%= (@results.where(shift: "キャッシュレス新規").sum(:other_food_get).to_f() / @results.where(shift: "キャッシュレス新規").length).round(1) %></td>
        <td><%= (@results.where(shift: "キャッシュレス新規").sum(:car_visit).to_f() / @results.where(shift: "キャッシュレス新規").length).round(1) %></td>
        <td><%= (@results.where(shift: "キャッシュレス新規").sum(:car_get).to_f() / @results.where(shift: "キャッシュレス新規").length).round(1) %></td>
        <td><%= (@results.where(shift: "キャッシュレス新規").sum(:other_retail_visit).to_f() / @results.where(shift: "キャッシュレス新規").length).round(1) %></td>
        <td><%= (@results.where(shift: "キャッシュレス新規").sum(:other_retail_get).to_f() / @results.where(shift: "キャッシュレス新規").length).round(1) %></td>
        <td><%= (@results.where(shift: "キャッシュレス新規").sum(:hair_salon_visit).to_f() / @results.where(shift: "キャッシュレス新規").length).round(1) %></td>
        <td><%= (@results.where(shift: "キャッシュレス新規").sum(:hair_salon_get).to_f() / @results.where(shift: "キャッシュレス新規").length).round(1) %></td>
        <td><%= (@results.where(shift: "キャッシュレス新規").sum(:manipulative_visit).to_f() / @results.where(shift: "キャッシュレス新規").length).round(1) %></td>
        <td><%= (@results.where(shift: "キャッシュレス新規").sum(:manipulative_get).to_f() / @results.where(shift: "キャッシュレス新規").length).round(1) %></td>
        <td><%= (@results.where(shift: "キャッシュレス新規").sum(:other_service_visit).to_f() / @results.where(shift: "キャッシュレス新規").length).round(1) %></td>
        <td><%= (@results.where(shift: "キャッシュレス新規").sum(:other_service_get).to_f() / @results.where(shift: "キャッシュレス新規").length).round(1) %></td>
      </tr>
    </table>
    </div>
    </div>
    <div style="display: flex;">
      <div>
      <h2>キャッシュレス切り返し</h2>
      <table class="out-tb">
        <thead>
        <tr>
          <th >切り返し内容</th>
          <th >内訳</th>
          <th>合計</th>
          <th>平均</th>
          <th>成約率</th>
        </tr>
        </thead>
        <tbody>
        <tr>
          <th rowspan="3" class="out-th">０１：どういうこと？</th>
          <th>決済者面会</th>
          <td><%= @results.includes(:result_cash).sum(:out_interview_01) %></td>
          <td><%= @results.includes(:result_cash).average(:out_interview_01).to_f.round(1) %></td>
          <td></td>
        </tr>
        <tr>
          <th>フル数</th>
          <td><%= @results.includes(:result_cash).sum(:out_full_talk_01) %></td>
          <td><%= @results.includes(:result_cash).average(:out_full_talk_01).to_f.round(1) %></td>
          <td><%= number_to_percentage(@results.includes(:result_cash).sum(:out_full_talk_01).to_f / @results.includes(:result_cash).sum(:out_interview_01).to_f * 100,precision: 1) %></td>
        </tr>
        <tr>
          <th>成約数</th>
          <td><%= @results.includes(:result_cash).sum(:out_get_01)%></td>
          <td><%= @results.includes(:result_cash).average(:out_get_01).to_f.round(1)%></td>
          <td><%= number_to_percentage(@results.includes(:result_cash).sum(:out_get_01).to_f / @results.includes(:result_cash).sum(:out_full_talk_01).to_f * 100,precision: 1) %></td>
        </tr>
        <tr>
        <th rowspan="3" class="out-th">０２：君は誰？協会？</th>
          <th>決済者面会</th>
          <td><%= @results.includes(:result_cash).sum(:out_interview_02) %></td>
          <td><%= @results.includes(:result_cash).average(:out_interview_02).to_f.round(1) %></td>
          <td></td>
        </tr>
        <tr>
          <th>フル数</th>
          <td><%= @results.includes(:result_cash).sum(:out_full_talk_02) %></td>
          <td><%= @results.includes(:result_cash).average(:out_full_talk_02).to_f.round(1) %></td>
          <td><%= number_to_percentage(@results.includes(:result_cash).sum(:out_full_talk_02).to_f / @results.includes(:result_cash).sum(:out_interview_02).to_f * 100,precision: 1)  %></td>
        </tr>
        <tr>
          <th>成約数</th>
          <td><%= @results.includes(:result_cash).sum(:out_get_02) %></td>
          <td><%= @results.includes(:result_cash).average(:out_get_02).to_f.round(1) %></td>
          <td><%= number_to_percentage(@results.includes(:result_cash).sum(:out_get_02).to_f / @results.includes(:result_cash).sum(:out_full_talk_02).to_f * 100,precision: 1)  %></td>
        </tr>
        <tr>
        <th rowspan="3" class="out-th">０３：もらうだけでいいの？</th>
          <th>決済者面会</th>
          <td><%= @results.includes(:result_cash).sum(:out_interview_03) %></td>
          <td><%= @results.includes(:result_cash).average(:out_interview_03).to_f.round(1) %></td>
          <td></td>
        </tr>
        <tr>
          <th>フル数</th>
          <td><%= @results.includes(:result_cash).sum(:out_full_talk_03).to_f.round(1) %></td>
          <td><%= @results.includes(:result_cash).average(:out_full_talk_03).to_f.round(1) %></td>
          <td><%= number_to_percentage(@results.includes(:result_cash).sum(:out_full_talk_03).to_f / @results.includes(:result_cash).sum(:out_interview_03).to_f * 100,precision: 1)  %></td>
        </tr>
        <tr>
          <th>成約数</th>
          <td><%= @results.includes(:result_cash).sum(:out_get_03).to_f.round(1) %></td>
          <td><%= @results.includes(:result_cash).average(:out_get_03).to_f.round(1) %></td>
          <td><%= number_to_percentage(@results.includes(:result_cash).sum(:out_get_03).to_f / @results.includes(:result_cash).sum(:out_full_talk_03).to_f * 100,precision: 1)  %></td>
        </tr>
        <tr>
        <th rowspan="3" class="out-th">０４：PayPayのみ</th>
          <th>決済者面会</th>
          <td><%= @results.includes(:result_cash).sum(:out_interview_04).to_f.round(1) %></td>
          <td><%= @results.includes(:result_cash).average(:out_interview_04).to_f.round(1) %></td>
          <td></td>
        </tr>
        <tr>
          <th>フル数</th>
          <td><%= @results.includes(:result_cash).sum(:out_full_talk_04).to_f.round(1) %></td>
          <td><%= @results.includes(:result_cash).average(:out_full_talk_04).to_f.round(1) %></td>
          <td><%= number_to_percentage(@results.includes(:result_cash).sum(:out_full_talk_04).to_f / @results.includes(:result_cash).sum(:out_interview_04).to_f * 100,precision: 1)  %></td>
        </tr>
        <tr>
          <th>成約数</th>
          <td><%= @results.includes(:result_cash).sum(:out_get_04).to_f.round(1) %></td>
          <td><%= @results.includes(:result_cash).average(:out_get_04).to_f.round(1) %></td>
          <td><%= number_to_percentage(@results.includes(:result_cash).sum(:out_get_04).to_f / @results.includes(:result_cash).sum(:out_full_talk_04).to_f * 100,precision: 1)  %></td>
        </tr>
        <tr>
        <th rowspan="3" class="out-th">０５：AirPayのみ</th>
          <th>決済者面会</th>
          <td><%= @results.includes(:result_cash).sum(:out_interview_05).to_f.round(1) %></td>
          <td><%= @results.includes(:result_cash).average(:out_interview_05).to_f.round(1) %></td>
          <td></td>
        </tr>
        <tr>
          <th>フル数</th>
          <td><%= @results.includes(:result_cash).sum(:out_full_talk_05).to_f.round(1) %></td>
          <td><%= @results.includes(:result_cash).average(:out_full_talk_05).to_f.round(1) %></td>
          <td><%= number_to_percentage(@results.includes(:result_cash).sum(:out_full_talk_05).to_f / @results.includes(:result_cash).sum(:out_interview_05).to_f * 100,precision: 1) %></td>
        </tr>
        <tr>
          <th>成約数</th>
          <td><%= @results.includes(:result_cash).sum(:out_get_05).to_f.round(1) %></td>
          <td><%= @results.includes(:result_cash).average(:out_get_05).to_f.round(1) %></td>
          <td><%= number_to_percentage(@results.includes(:result_cash).sum(:out_get_05).to_f / @results.includes(:result_cash).sum(:out_full_talk_05).to_f * 100,precision: 1)  %></td>
        </tr>
        <tr>
        <th rowspan="3" class="out-th">０６：カードのみ</th>
          <th>決済者面会</th>
          <td><%= @results.includes(:result_cash).sum(:out_interview_06).to_f.round(1) %></td>
          <td><%= @results.includes(:result_cash).average(:out_interview_06).to_f.round(1) %></td>
          <td></td>
        </tr>
        <tr>
          <th>フル数</th>
          <td><%= @results.includes(:result_cash).sum(:out_full_talk_06).to_f.round(1) %></td>
          <td><%= @results.includes(:result_cash).average(:out_full_talk_06).to_f.round(1) %></td>
          <td><%= number_to_percentage(@results.includes(:result_cash).sum(:out_full_talk_06).to_f / @results.includes(:result_cash).sum(:out_interview_06).to_f * 100,precision: 1) %></td>
        </tr>
        <tr>
          <th>成約数</th>
          <td><%= @results.includes(:result_cash).sum(:out_get_06).to_f.round(1) %></td>
          <td><%= @results.includes(:result_cash).average(:out_get_06).to_f.round(1) %></td>
          <td><%= number_to_percentage(@results.includes(:result_cash).sum(:out_get_06).to_f / @results.includes(:result_cash).sum(:out_full_talk_06).to_f * 100,precision: 1)  %></td>
        </tr>
        <tr>
        <th rowspan="3" class="out-th">０７：先延ばし</th>
          <th>決済者面会</th>
          <td><%= @results.includes(:result_cash).sum(:out_interview_07).to_f.round(1) %></td>
          <td><%= @results.includes(:result_cash).average(:out_interview_07).to_f.round(1) %></td>
          <td></td>
        </tr>
        <tr>
          <th>フル数</th>
          <td><%= @results.includes(:result_cash).sum(:out_full_talk_07).to_f.round(1) %></td>
          <td><%= @results.includes(:result_cash).average(:out_full_talk_07).to_f.round(1) %></td>
          <td><%= number_to_percentage(@results.includes(:result_cash).sum(:out_full_talk_07).to_f / @results.includes(:result_cash).sum(:out_interview_07).to_f * 100,precision: 1) %></td>
        </tr>
        <tr>
          <th>成約数</th>
          <td><%= @results.includes(:result_cash).sum(:out_get_07).to_f.round(1) %></td>
          <td><%= @results.includes(:result_cash).average(:out_get_07).to_f.round(1) %></td>
          <td><%= number_to_percentage(@results.includes(:result_cash).sum(:out_get_07).to_f / @results.includes(:result_cash).sum(:out_full_talk_07).to_f * 100,precision: 1)  %></td>
        </tr>
        <tr>
        <th rowspan="3" class="out-th">０８：忙しい</th>
          <th>決済者面会</th>
          <td><%= @results.includes(:result_cash).sum(:out_interview_08).to_f.round(1) %></td>
          <td><%= @results.includes(:result_cash).average(:out_interview_08).to_f.round(1) %></td>
          <td></td>
        </tr>
        <tr>
          <th>フル数</th>
          <td><%= @results.includes(:result_cash).sum(:out_full_talk_08).to_f.round(1) %></td>
          <td><%= @results.includes(:result_cash).average(:out_full_talk_08).to_f.round(1) %></td>
          <td><%= number_to_percentage(@results.includes(:result_cash).sum(:out_full_talk_08).to_f / @results.includes(:result_cash).sum(:out_interview_08).to_f * 100,precision: 1) %></td>
        </tr>
        <tr>
          <th>成約数</th>
          <td><%= @results.includes(:result_cash).sum(:out_get_08).to_f.round(1) %></td>
          <td><%= @results.includes(:result_cash).average(:out_get_08).to_f.round(1) %></td>
          <td><%= number_to_percentage(@results.includes(:result_cash).sum(:out_get_08).to_f / @results.includes(:result_cash).sum(:out_full_talk_08).to_f * 100,precision: 1)  %></td>
        </tr>
        <tr>
        <th rowspan="3" class="out-th">０９：現金のみ</th>
          <th>決済者面会</th>
          <td><%= @results.includes(:result_cash).sum(:out_interview_09).to_f.round(1) %></td>
          <td><%= @results.includes(:result_cash).average(:out_interview_09).to_f.round(1) %></td>
          <td></td>
        </tr>
        <tr>
          <th>フル数</th>
          <td><%= @results.includes(:result_cash).sum(:out_full_talk_09).to_f.round(1) %></td>
          <td><%= @results.includes(:result_cash).average(:out_full_talk_09).to_f.round(1) %></td>
          <td><%= number_to_percentage(@results.includes(:result_cash).sum(:out_full_talk_09).to_f / @results.includes(:result_cash).sum(:out_interview_09).to_f * 100,precision: 1) %></td>
        </tr>
        <tr>
          <th>成約数</th>
          <td><%= @results.includes(:result_cash).sum(:out_get_09).to_f.round(1) %></td>
          <td><%= @results.includes(:result_cash).average(:out_get_09).to_f.round(1) %></td>
          <td><%= number_to_percentage(@results.includes(:result_cash).sum(:out_get_09).to_f / @results.includes(:result_cash).sum(:out_full_talk_09).to_f * 100,precision: 1)  %></td>
        </tr>
        <tr>
        <th rowspan="3" class="out-th">１０：面倒くさい</th>
          <th>決済者面会</th>
          <td><%= @results.includes(:result_cash).sum(:out_interview_10).to_f.round(1) %></td>
          <td><%= @results.includes(:result_cash).average(:out_interview_10).to_f.round(1) %></td>
          <td></td>
        </tr>
        <tr>
          <th>フル数</th>
          <td><%= @results.includes(:result_cash).sum(:out_full_talk_10).to_f.round(1) %></td>
          <td><%= @results.includes(:result_cash).average(:out_full_talk_10).to_f.round(1) %></td>
          <td><%= number_to_percentage(@results.includes(:result_cash).sum(:out_full_talk_10).to_f / @results.includes(:result_cash).sum(:out_interview_10).to_f * 100,precision: 1) %></td>
        </tr>
        <tr>
          <th>成約数</th>
          <td><%= @results.includes(:result_cash).sum(:out_get_10).to_f.round(1) %></td>
          <td><%= @results.includes(:result_cash).average(:out_get_10).to_f.round(1) %></td>
          <td><%= number_to_percentage(@results.includes(:result_cash).sum(:out_get_10).to_f / @results.includes(:result_cash).sum(:out_full_talk_10).to_f * 100,precision: 1)  %></td>
        </tr>
        <tr>
        <th rowspan="3" class="out-th">１１：情報不足</th>
          <th>決済者面会</th>
          <td><%= @results.includes(:result_cash).sum(:out_interview_11).to_f.round(1) %></td>
          <td><%= @results.includes(:result_cash).average(:out_interview_11).to_f.round(1) %></td>
          <td></td>
        </tr>
        <tr>
          <th>フル数</th>
          <td><%= @results.includes(:result_cash).sum(:out_full_talk_11).to_f.round(1) %></td>
          <td><%= @results.includes(:result_cash).average(:out_full_talk_11).to_f.round(1) %></td>
          <td><%= number_to_percentage(@results.includes(:result_cash).sum(:out_full_talk_11).to_f / @results.includes(:result_cash).sum(:out_interview_11).to_f * 100,precision: 1) %></td>
        </tr>
        <tr>
          <th>成約数</th>
          <td><%= @results.includes(:result_cash).sum(:out_get_11).to_f.round(1) %></td>
          <td><%= @results.includes(:result_cash).average(:out_get_11).to_f.round(1) %></td>
          <td><%= number_to_percentage(@results.includes(:result_cash).sum(:out_get_11).to_f / @results.includes(:result_cash).sum(:out_full_talk_11).to_f * 100,precision: 1)  %></td>
        </tr>
        <tr>
        <th rowspan="3" class="out-th">１２：ペロ</th>
          <th>決済者面会</th>
          <td><%= @results.includes(:result_cash).sum(:out_interview_12).to_f.round(1) %></td>
          <td><%= @results.includes(:result_cash).average(:out_interview_12).to_f.round(1) %></td>
          <td></td>
        </tr>
        <tr>
          <th>フル数</th>
          <td><%= @results.includes(:result_cash).sum(:out_full_talk_12).to_f.round(1) %></td>
          <td><%= @results.includes(:result_cash).average(:out_full_talk_12).to_f.round(1) %></td>
          <td><%= number_to_percentage(@results.includes(:result_cash).sum(:out_full_talk_12).to_f / @results.includes(:result_cash).sum(:out_interview_12).to_f * 100,precision: 1) %></td>
        </tr>
        <tr>
          <th>成約数</th>
          <td><%= @results.includes(:result_cash).sum(:out_get_12).to_f.round(1) %></td>
          <td><%= @results.includes(:result_cash).average(:out_get_12).to_f.round(1) %></td>
          <td><%= number_to_percentage(@results.includes(:result_cash).sum(:out_get_12).to_f / @results.includes(:result_cash).sum(:out_full_talk_12).to_f * 100,precision: 1)  %></td>
        </tr>
        <tr>
        <th rowspan="3" class="out-th">１３：その他</th>
          <th>決済者面会</th>
          <td><%= @results.includes(:result_cash).sum(:out_interview_13).to_f.round(1) %></td>
          <td><%= @results.includes(:result_cash).average(:out_interview_13).to_f.round(1) %></td>
          <td></td>
        </tr>
        <tr>
          <th>フル数</th>
          <td><%= @results.includes(:result_cash).sum(:out_full_talk_13).to_f.round(1) %></td>
          <td><%= @results.includes(:result_cash).average(:out_full_talk_13).to_f.round(1) %></td>
          <td><%= number_to_percentage(@results.includes(:result_cash).sum(:out_full_talk_13).to_f / @results.includes(:result_cash).sum(:out_interview_13).to_f * 100,precision: 1) %></td>
        </tr>
        <tr>
          <th>成約数</th>
          <td><%= @results.includes(:result_cash).sum(:out_get_13).to_f.round(1) %></td>
          <td><%= @results.includes(:result_cash).average(:out_get_13).to_f.round(1) %></td>
          <td><%= number_to_percentage(@results.includes(:result_cash).sum(:out_get_13).to_f / @results.includes(:result_cash).sum(:out_full_talk_13).to_f * 100,precision: 1)  %></td>
        </tr>
        <tr>
          <th colspan="6">　　</th>
        </tr>
        </tbody>
        </table>
      </div>
      <div>
      <h2>訪問店舗比率</h2>
        <%= pie_chart @chart, width:'400px',suffix: "%" %>
      </div>
      <div>
      <h2>切り返し比率（母体数）</h2>
        <%= pie_chart @cash_out_chart, width:'500px',suffix: "%" %>
      </div>
    </div>
    <% end %>
    <% if @results.where(shift: "楽天フェムト新規").empty? %>
    <% else %>
    <div style="display: flex;">
    <div>
  <h2>楽天フェムト新規</h2>
    <table>
    <tr>
    </tr>
      <tr>
        <th colspan="4">合計</th>
        <th colspan="4">前半</th>
        <th colspan="4">後半</th>
      </tr>
      <tr>
      <% 3.times do %>
        <th style="border-left: 1px solid rgb(214, 219, 235);">訪問</th>
        <th>対面</th>
        <th>フル</th>
        <th>成約</th>
      <% end %>
      </tr>
      <tr>
      <%# 合計 %>
        <td><%= (@results.where(shift: "楽天フェムト新規").sum("first_visit + latter_visit").to_f / @results.where(shift: "楽天フェムト新規").length).to_f().round(1) %></td>
        <td><%= (@results.where(shift: "楽天フェムト新規").sum("first_interview + latter_interview").to_f / @results.where(shift: "楽天フェムト新規").length).to_f().round(1) %></td>
        <td><%= (@results.where(shift: "楽天フェムト新規").sum("first_full_talk + latter_full_talk").to_f / @results.where(shift: "楽天フェムト新規").length).to_f().round(1) %></td>
        <td><%= (@results.where(shift: "楽天フェムト新規").sum("first_get + latter_get").to_f / @results.where(shift: "楽天フェムト新規").length).to_f().round(1) %></td>
      <%# 前半 %>
        <td><%= (@results.where(shift: "楽天フェムト新規").sum(:first_visit).to_f / @results.where(shift: "楽天フェムト新規").length).round(1) %></td>
        <td><%= (@results.where(shift: "楽天フェムト新規").sum(:first_interview).to_f / @results.where(shift: "楽天フェムト新規").length).round(1) %></td>
        <td><%= (@results.where(shift: "楽天フェムト新規").sum(:first_full_talk).to_f / @results.where(shift: "楽天フェムト新規").length).round(1) %></td>
        <td><%= (@results.where(shift: "楽天フェムト新規").sum(:first_get).to_f / @results.where(shift: "楽天フェムト新規").length).round(1) %></td>
      <%# 後半 %>
        <td><%= (@results.where(shift: "楽天フェムト新規").sum(:latter_visit).to_f / @results.where(shift: "楽天フェムト新規").length).round(1) %></td>
        <td><%= (@results.where(shift: "楽天フェムト新規").sum(:latter_interview).to_f / @results.where(shift: "楽天フェムト新規").length).round(1) %></td>
        <td><%= (@results.where(shift: "楽天フェムト新規").sum(:latter_full_talk).to_f / @results.where(shift: "楽天フェムト新規").length).round(1) %></td>
        <td><%= (@results.where(shift: "楽天フェムト新規").sum(:latter_get).to_f / @results.where(shift: "楽天フェムト新規").length).round(1) %></td>
      </tr>
    </table>
    </div>
    <div>
    <h2>店舗別基準値</h2>
    <table>
      <tr>
        <th colspan="2">喫茶・カフェ</th>
        <th colspan="2">その他飲食</th>
        <th colspan="2">車屋</th>
        <th colspan="2">その他小売</th>
        <th colspan="2">理容・美容</th>
        <th colspan="2">整体・鍼灸</th>
        <th colspan="2">その他サービス</th>
      </tr>
      <tr>
      <% 7.times do %>
        <th>訪問</th>
        <th>獲得</th>
      <% end %>
      </tr>
      <tr>
      </tr>
    <%# 店舗別基準値（値） %>
      <tr>
        <td><%= (@results.where(shift: "楽天フェムト新規").sum(:cafe_visit).to_f() / @results.where(shift: "楽天フェムト新規").length).round(1) %></td>
        <td><%= (@results.where(shift: "楽天フェムト新規").sum(:cafe_get).to_f() / @results.where(shift: "楽天フェムト新規").length).round(1) %></td>
        <td><%= (@results.where(shift: "楽天フェムト新規").sum(:other_food_visit).to_f() / @results.where(shift: "楽天フェムト新規").length).round(1) %></td>
        <td><%= (@results.where(shift: "楽天フェムト新規").sum(:other_food_get).to_f() / @results.where(shift: "楽天フェムト新規").length).round(1) %></td>
        <td><%= (@results.where(shift: "楽天フェムト新規").sum(:car_visit).to_f() / @results.where(shift: "楽天フェムト新規").length).round(1) %></td>
        <td><%= (@results.where(shift: "楽天フェムト新規").sum(:car_get).to_f() / @results.where(shift: "楽天フェムト新規").length).round(1) %></td>
        <td><%= (@results.where(shift: "楽天フェムト新規").sum(:other_retail_visit).to_f() / @results.where(shift: "楽天フェムト新規").length).round(1) %></td>
        <td><%= (@results.where(shift: "楽天フェムト新規").sum(:other_retail_get).to_f() / @results.where(shift: "楽天フェムト新規").length).round(1) %></td>
        <td><%= (@results.where(shift: "楽天フェムト新規").sum(:hair_salon_visit).to_f() / @results.where(shift: "楽天フェムト新規").length).round(1) %></td>
        <td><%= (@results.where(shift: "楽天フェムト新規").sum(:hair_salon_get).to_f() / @results.where(shift: "楽天フェムト新規").length).round(1) %></td>
        <td><%= (@results.where(shift: "楽天フェムト新規").sum(:manipulative_visit).to_f() / @results.where(shift: "楽天フェムト新規").length).round(1) %></td>
        <td><%= (@results.where(shift: "楽天フェムト新規").sum(:manipulative_get).to_f() / @results.where(shift: "楽天フェムト新規").length).round(1) %></td>
        <td><%= (@results.where(shift: "楽天フェムト新規").sum(:other_service_visit).to_f() / @results.where(shift: "楽天フェムト新規").length).round(1) %></td>
        <td><%= (@results.where(shift: "楽天フェムト新規").sum(:other_service_get).to_f() / @results.where(shift: "楽天フェムト新規").length).round(1) %></td>
      </tr>
    </table>
    </div>
  </div>
  <div style="display: flex;">
      <table>
        <tr>
          <th></th>
          <th>決済者面会</th>
          <th>フル数</th>
          <th>フル率（％）</th>
          <th>成約数</th>
          <th>成約率（％）</th>
        </tr>
        <tr>
          <% casa_out = @results.includes(:result_casa) %>
          <th style="text-align:left;">０１：楽天使ってない</th>
          <td><%= casa_out.average(:out_interview_01).to_f.round(1) %></td>
          <td><%= casa_out.average(:out_full_talk_01).to_f.round(1) %></td>
          <td><%= number_to_percentage(casa_out.sum(:out_full_talk_01).to_f / casa_out.sum(:out_interview_01).to_f * 100,precision: 1) %></td>
          <td><%= casa_out.average(:out_get_01).to_f.round(1)%></td>
          <td><%= number_to_percentage(casa_out.sum(:out_get_01).to_f / casa_out.sum(:out_full_talk_01).to_f * 100,precision: 1) %></td>
        </tr>
        <tr>
          <th style="text-align:left;">０２：面倒くさい</th>
          <td><%= casa_out.average(:out_interview_02).to_f.round(1) %></td>
          <td><%= casa_out.average(:out_full_talk_02).to_f.round(1) %></td>
          <td><%= number_to_percentage(casa_out.sum(:out_full_talk_02).to_f / casa_out.sum(:out_interview_02).to_f * 100,precision: 1)  %></td>
          <td><%= casa_out.average(:out_get_02).to_f.round(1) %></td>
          <td><%= number_to_percentage(casa_out.sum(:out_get_02).to_f / casa_out.sum(:out_full_talk_02).to_f * 100,precision: 1)  %></td>
        </tr>
        <tr>
          <th style="text-align:left;">０３：置く場所がない</th>
          <td><%= casa_out.average(:out_interview_03).to_f.round(1) %></td>
          <td><%= casa_out.average(:out_full_talk_03).to_f.round(1) %></td>
          <td><%= number_to_percentage(casa_out.sum(:out_full_talk_03).to_f / casa_out.sum(:out_interview_03).to_f * 100,precision: 1)  %></td>
          <td><%= casa_out.average(:out_get_03).to_f.round(1) %></td>
          <td><%= number_to_percentage(casa_out.sum(:out_get_03).to_f / casa_out.sum(:out_full_talk_03).to_f * 100,precision: 1)  %></td>
        </tr>
        <tr>
          <th style="text-align:left;">０４：メリットがない</th>
          <td><%= casa_out.average(:out_interview_04).to_f.round(1) %></td>
          <td><%= casa_out.average(:out_full_talk_04).to_f.round(1) %></td>
          <td><%= number_to_percentage(casa_out.sum(:out_full_talk_04).to_f / casa_out.sum(:out_interview_04).to_f * 100,precision: 1)  %></td>
          <td><%= casa_out.average(:out_get_04).to_f.round(1) %></td>
          <td><%= number_to_percentage(casa_out.sum(:out_get_04).to_f / casa_out.sum(:out_full_talk_04).to_f * 100,precision: 1)  %></td>
        </tr>
        <tr>
          <th style="text-align:left;">０５：前断った</th>
          <td><%= casa_out.average(:out_interview_05).to_f.round(1) %></td>
          <td><%= casa_out.average(:out_full_talk_05).to_f.round(1) %></td>
          <td><%= number_to_percentage(casa_out.sum(:out_full_talk_05).to_f / casa_out.sum(:out_interview_05).to_f * 100,precision: 1) %></td>
          <td><%= casa_out.average(:out_get_05).to_f.round(1) %></td>
          <td><%= number_to_percentage(casa_out.sum(:out_get_05).to_f / casa_out.sum(:out_full_talk_05).to_f * 100,precision: 1)  %></td>
        </tr>
        <tr>
          <th style="text-align:left;">０６：必要ない</th>
          <td><%= casa_out.average(:out_interview_06).to_f.round(1) %></td>
          <td><%= casa_out.average(:out_full_talk_06).to_f.round(1) %></td>
          <td><%= number_to_percentage(casa_out.sum(:out_full_talk_06).to_f / casa_out.sum(:out_interview_06).to_f * 100,precision: 1) %></td>
          <td><%= casa_out.average(:out_get_06).to_f.round(1) %></td>
          <td><%= number_to_percentage(casa_out.sum(:out_get_06).to_f / casa_out.sum(:out_full_talk_06).to_f * 100,precision: 1)  %></td>
        </tr>
        <tr>
          <th style="text-align:left;">０７：忙しい</th>
          <td><%= casa_out.average(:out_interview_07).to_f.round(1) %></td>
          <td><%= casa_out.average(:out_full_talk_07).to_f.round(1) %></td>
          <td><%= number_to_percentage(casa_out.sum(:out_full_talk_07).to_f / casa_out.sum(:out_interview_07).to_f * 100,precision: 1) %></td>
          <td><%= casa_out.average(:out_get_07).to_f.round(1) %></td>
          <td><%= number_to_percentage(casa_out.sum(:out_get_07).to_f / casa_out.sum(:out_full_talk_07).to_f * 100,precision: 1)  %></td>
        </tr>
        <tr>
          <th style="text-align:left;">０８：ペロ</th>
          <td><%= casa_out.average(:out_interview_08).to_f.round(1) %></td>
          <td><%= casa_out.average(:out_full_talk_08).to_f.round(1) %></td>
          <td><%= number_to_percentage(casa_out.sum(:out_full_talk_08).to_f / casa_out.sum(:out_interview_08).to_f * 100,precision: 1) %></td>
          <td><%= casa_out.average(:out_get_08).to_f.round(1) %></td>
          <td><%= number_to_percentage(casa_out.sum(:out_get_08).to_f / casa_out.sum(:out_full_talk_08).to_f * 100,precision: 1)  %></td>
        </tr>
          <th style="text-align:left;">０９：その他</th>
          <td><%= casa_out.average(:out_interview_09).to_f.round(1) %></td>
          <td><%= casa_out.average(:out_full_talk_09).to_f.round(1) %></td>
          <td><%= number_to_percentage(casa_out.sum(:out_full_talk_09).to_f / casa_out.sum(:out_interview_09).to_f * 100,precision: 1) %></td>
          <td><%= casa_out.average(:out_get_09).to_f.round(1) %></td>
          <td><%= number_to_percentage(casa_out.sum(:out_get_09).to_f / casa_out.sum(:out_full_talk_09).to_f * 100,precision: 1)  %></td>
        </tr>
      </table>
    <div>
      <h2>訪問店舗比率</h2>
        <%= pie_chart @chart, width:'400px',suffix: "%" %>
    </div>
  </div>
    <% end %>
    <% if @results.where(shift: "サミット").empty? %>
    <% else %>
  </div>
    <div style="display: flex;">
  <h2>サミット</h2>
    <table>
      <tr>
        <th>訪問</th>
        <th>対面</th>
        <th>フル</th>
        <th>成約</th>
      </tr>
      <tr>
        <td><%= (@results.where(shift: "サミット").sum("first_visit + latter_visit") / @results.where(shift: "サミット").length).to_f().round(1) %></td>
        <td><%= (@results.where(shift: "サミット").sum("first_interview + latter_interview") / @results.where(shift: "サミット").length).to_f().round(1) %></td>
        <td><%= (@results.where(shift: "サミット").sum("first_full_talk + latter_full_talk") / @results.where(shift: "サミット").length).to_f().round(1) %></td>
        <td><%= (@results.where(shift: "サミット").sum("first_get + latter_get") / @results.where(shift: "サミット").length).to_f().round(1) %></td>
      </tr>
    </table>
    </div>
    <div>
    <h2>店舗別基準値</h2>
    <table>
      <tr>
        <th colspan="2">喫茶・カフェ</th>
        <th colspan="2">その他飲食</th>
        <th colspan="2">車屋</th>
        <th colspan="2">その他小売</th>
        <th colspan="2">理容・美容</th>
        <th colspan="2">整体・鍼灸</th>
        <th colspan="2">その他サービス</th>
      </tr>
      <tr>
      <% 7.times do %>
        <th>訪問</th>
        <th>獲得</th>
      <% end %>
      </tr>
      <tr>
      </tr>
    <%# 店舗別基準値（値） %>
      <tr>
        <td><%= (@results.where(shift: "サミット").sum(:cafe_visit).to_f() / @results.where(shift: "サミット").length).round(1) %></td>
        <td><%= (@results.where(shift: "サミット").sum(:cafe_get).to_f() / @results.where(shift: "サミット").length).round(1) %></td>
        <td><%= (@results.where(shift: "サミット").sum(:other_food_visit).to_f() / @results.where(shift: "サミット").length).round(1) %></td>
        <td><%= (@results.where(shift: "サミット").sum(:other_food_get).to_f() / @results.where(shift: "サミット").length).round(1) %></td>
        <td><%= (@results.where(shift: "サミット").sum(:car_visit).to_f() / @results.where(shift: "サミット").length).round(1) %></td>
        <td><%= (@results.where(shift: "サミット").sum(:car_get).to_f() / @results.where(shift: "サミット").length).round(1) %></td>
        <td><%= (@results.where(shift: "サミット").sum(:other_retail_visit).to_f() / @results.where(shift: "サミット").length).round(1) %></td>
        <td><%= (@results.where(shift: "サミット").sum(:other_retail_get).to_f() / @results.where(shift: "サミット").length).round(1) %></td>
        <td><%= (@results.where(shift: "サミット").sum(:hair_salon_visit).to_f() / @results.where(shift: "サミット").length).round(1) %></td>
        <td><%= (@results.where(shift: "サミット").sum(:hair_salon_get).to_f() / @results.where(shift: "サミット").length).round(1) %></td>
        <td><%= (@results.where(shift: "サミット").sum(:manipulative_visit).to_f() / @results.where(shift: "サミット").length).round(1) %></td>
        <td><%= (@results.where(shift: "サミット").sum(:manipulative_get).to_f() / @results.where(shift: "サミット").length).round(1) %></td>
        <td><%= (@results.where(shift: "サミット").sum(:other_service_visit).to_f() / @results.where(shift: "サミット").length).round(1) %></td>
        <td><%= (@results.where(shift: "サミット").sum(:other_service_get).to_f() / @results.where(shift: "サミット").length).round(1) %></td>
      </tr>
    </table>
    </div>
    </div>
    <% end %>

  <h1>日々進捗</h1>
    <table class="out-tb">
    <thead>
      <tr></tr>
      <tr>
        <th colspan="6">終着</th>
        <th colspan="5">合計</th>
        <th colspan="4">前半</th>
        <th colspan="4">後半</th>
        <th rowspan="2">　店舗別　</th>
        <th colspan="2">喫茶・カフェ</th>
        <th colspan="2">その他飲食</th>
        <th colspan="2">車屋</th>
        <th colspan="2">その他小売</th>
        <th colspan="2">理容・美容</th>
        <th colspan="2">整体・鍼灸</th>
        <th colspan="2">その他サービス</th>
      <%# キャッシュレス切り返し %>
        <% if @results.where(shift: "キャッシュレス新規").empty? %>
        <% else %>
        <th rowspan="2">　キャッシュ切り返し　</th>
        <th colspan="3">どういうこと？</th>
        <th colspan="3">君は誰？協会？</th>
        <th colspan="3">もらうだけでいいの？</th>
        <th colspan="3">PayPayのみ</th>
        <th colspan="3">AirPayのみ</th>
        <th colspan="3">カードのみ</th>
        <th colspan="3">先延ばし</th>
        <th colspan="3">忙しい</th>
        <th colspan="3">現金のみ</th>
        <th colspan="3">面倒くさい</th>
        <th colspan="3">情報不足</th>
        <th colspan="3">ペロ</th>
        <th colspan="3">その他</th>
        <% end %>
      <%# サミット切り返し %>
        <% if @results.where(shift: "サミット").empty? %>
        <% else %>
        <th rowspan="2">　サミット切り返し　</th>
        <th colspan="2">NG理由</th>
        <th colspan="3">引き落とし拒否</th>
        <th colspan="3">忙しい</th>
        <th colspan="3">怪しい</th>
        <th colspan="3">検討したい</th>
        <th colspan="3">変えたくない</th>
        <th colspan="3">ペロ</th>
        <th colspan="3">その他</th>
        <% end %>
      <%# フェムト切り返し %>
        <% if @results.where(shift: "楽天フェムト新規").empty? %>
        <% else %>
        <th rowspan="2">　フェムト切り返し　</th>
        <th colspan="3">０１：楽天使ってない</th>
        <th colspan="3">０２：面倒くさい</th>
        <th colspan="3">０３：置く場所がない</th>
        <th colspan="3">０４：メリットがない</th>
        <th colspan="3">０５：前断った</th>
        <th colspan="3">０６：必要ない</th>
        <th colspan="3">０７：忙しい</th>
        <th colspan="3">０８：ペロ</th>
        <th colspan="3">０９：その他</th>
        <% end %>
      </tr>
      <tr >
      <%# 大枠基準値（見出し） %>
          <th></th>
          <th></th>
          <th>シフト</th>
          <th>日付</th>
          <th>帯同</th>
          <th>エリア</th>
          <th>売上</th>
          <th>訪問数</th>
          <th>対面数</th>
          <th>フル数</th>
          <th>成約数</th>
          <th>訪問数</th>
          <th>対面数</th>
          <th>フル数</th>
          <th>成約数</th>
          <th>訪問数</th>
          <th>対面数</th>
          <th>フル数</th>
          <th>成約数</th>
      <%# 店舗別基準値（見出し） %>
        <% 7.times do %>
        <th>訪問数</th>
        <th>獲得数</th>
        <% end %>
      <%# キャッシュレス切り返し（見出し） %>
        <% if @results.where(shift: "キャッシュレス新規").empty? %>
        <% else %>
          <% 13.times do %>
          <th style="border-left: 1px solid rgb(214, 219, 235);">対面数</th>
          <th>フル数</th>
          <th>成約数</th>
          <% end %>
        <% end %>
      <%# サミット切り返し（見出し） %>
        <% if @results.where(shift: "サミット").empty? %>
        <% else %>
          <th>明細なし</th>
          <th>明細NG</th>
          <% 7.times do %>
          <th style="border-left: 1px solid rgb(214, 219, 235);">対面数</th>
          <th>フル数</th>
          <th>成約数</th>
          <% end %>
        <% end %>
      <%# フェムト切り返し（見出し） %>
        <% if @results.where(shift: "楽天フェムト新規").empty? %>
        <% else %>
          <% 9.times do %>
            <th style="border-left: 1px solid rgb(214, 219, 235);">対面数</th>
            <th>フル数</th>
            <th>成約数</th>
          <% end %>
        <% end %>
      </tr>
    </thead>
    <tbody>
    <% @results.each do |result| %>
      <tr>
        <td style="padding: 0 20px;"><%= link_to "基準値編集", edit_result_path(result.id),class: "link" %></td>
        <% if result.shift == "キャッシュレス新規" %>
        <td style="padding: 0 20px;"><%= link_to "切り返し編集", edit_result_cash_path(result.result_cash.id),class: "link" %></td>
        <% elsif result.shift == "楽天フェムト新規" %>
        <td style="padding: 0 20px;"><%# link_to "切り返し編集", edit_result_casa_path(result.result_casa.id),class: "link"  %></td>
        <% else %>
        <td></td>
        <% end %>
        <td ><%= result.shift %></td>
        <td ><%= result.date.month %>月<%= result.date.day %>日</td>
        <td ><%= result.ojt.name rescue "" %></td>
        <td ><%= result.area %></td>
        <%# その日の売上 %>
          <%# フェムト設置依頼 %>
          <% casa_put_request = RakutenCasa.where(put: result.date).where(user_id: result.user_id).where.not(putter_id: result.user_id).sum(:valuation_put).to_f * 0.2 %>
          <%# フェムト他者設置 %>
          <% casa_put_other = RakutenCasa.where(put: result.date).where(putter_id: result.user_id).where.not(user_id: result.user_id).sum(:valuation_put).to_f * 0.8 %>
          <%# フェムト自分で設置 %>
          <% casa_put_self = RakutenCasa.where(put: result.date).where(user_id: result.user_id).where(putter_id: result.user_id).sum(:valuation_put).to_f %>
          <% date_profit =
          Dmer.where(user_id: result.user_id).where(date: result.date).sum(:valuation_new) +
          Dmer.where(status_settlement: "完了").where(settlementer_id: result.user_id).where(settlement: result.date).sum(:valuation_settlement) +
          Aupay.where(user_id: result.user_id).where(date: result.date).sum(:valuation_new) + 
          Aupay.where(status_settlement: "完了").where(settlementer_id: result.user_id).where(settlement: result.date).sum(:valuation_settlement) +
          Paypay.where(user_id: result.user_id).where(date: result.date).sum(:valuation) +
          StInsurance.where(user_id: result.user_id).where(date: result.date).sum(:valuation) +
          RakutenPay.where(user_id: result.user_id).where(date: result.date).sum(:valuation) +
          RakutenCasa.where(user_id: result.user_id).where(date: result.date).sum(:valuation_new) +
          casa_put_self + casa_put_other + casa_put_request %>
        <td ><%= date_profit.round().to_s(:delimited) %></td>
        <td ><%= result.first_visit + result.latter_visit %></td>
        <td ><%= result.first_interview + result.latter_interview %></td>
        <td ><%= result.first_full_talk + result.latter_full_talk %></td>
      <td ><%= result.first_get + result.latter_get %></td>
    <%#前半%>
      <td ><%= result.first_visit  %></td>
      <td ><%= result.first_interview %></td>
      <td ><%= result.first_full_talk %></td>
      <td ><%= result.first_get %></td>
    <%# 後半 %>
      <td ><%= result.latter_visit %></td>
      <td ><%= result.latter_interview %></td>
      <td ><%= result.latter_full_talk %></td>
      <td ><%= result.latter_get %></td>
    <%# 店舗別基準値(値) %>
      <td class="td-blank"></td>
      <%# 喫茶・カフェ %>
        <td ><%= result.cafe_visit %></td>
        <td ><%= result.cafe_get %></td>
      <%#その他飲食%>
        <td ><%= result.other_food_visit %></td>
        <td ><%= result.other_food_get %></td>
      <%#車屋%>
        <td ><%= result.car_visit %></td>
        <td ><%= result.car_get %></td>
      <%#その他小売%>
        <td ><%= result.other_retail_visit %></td>
        <td ><%= result.other_retail_get %></td>
      <%#理容・美容%>
        <td ><%= result.hair_salon_visit %></td>
        <td ><%= result.hair_salon_get %></td>
      <%#整体・鍼灸%>
        <td ><%= result.manipulative_visit %></td>
        <td ><%= result.manipulative_get %></td>
      <%#その他・サービス%>
        <td ><%= result.other_service_visit %></td>
        <td ><%= result.other_service_get %></td>
    <%# キャッシュレス切り返し %>
      <% if @results.where(shift: "キャッシュレス新規").empty? %>
      <% else %>
        <% if result.result_cash.nil? %>
          <td class="td-blank"></td>
          <% 39.times do %>
          <td class="td-blank"></td>
          <% end %>
        <% else %>
        <td class="td-blank"></td>
        <%#どういうこと？%>
        <td ><%= result.result_cash.out_interview_01 %></td>
        <td ><%= result.result_cash.out_full_talk_01 %></td>
        <td ><%= result.result_cash.out_get_01 %></td>
        <%#君は誰？%>
        <td ><%= result.result_cash.out_interview_02 %></td>
        <td ><%= result.result_cash.out_full_talk_02 %></td>
        <td ><%= result.result_cash.out_get_02 %></td>
        <%#もうらだけでいいの？%>
        <td ><%= result.result_cash.out_interview_03 %></td>
        <td ><%= result.result_cash.out_full_talk_03 %></td>
        <td ><%= result.result_cash.out_get_03 %></td>
        <%#PayPayのみ%>
        <td ><%= result.result_cash.out_interview_04 %></td>
        <td ><%= result.result_cash.out_full_talk_04 %></td>
        <td ><%= result.result_cash.out_get_04 %></td>
        <%#AirPayのみ%>
        <td ><%= result.result_cash.out_interview_05 %></td>
        <td ><%= result.result_cash.out_full_talk_05 %></td>
        <td ><%= result.result_cash.out_get_05 %></td>
        <%#カードのみ%>
        <td ><%= result.result_cash.out_interview_06 %></td>
        <td ><%= result.result_cash.out_full_talk_06 %></td>
        <td ><%= result.result_cash.out_get_06 %></td>
        <%#先延ばし%>
        <td ><%= result.result_cash.out_interview_07 %></td>
        <td ><%= result.result_cash.out_full_talk_07 %></td>
        <td ><%= result.result_cash.out_get_07 %></td>
        <%#現金のみ%>
        <td ><%= result.result_cash.out_interview_08 %></td>
        <td ><%= result.result_cash.out_full_talk_08 %></td>
        <td ><%= result.result_cash.out_get_08 %></td>
        <%#忙しい%>
        <td ><%= result.result_cash.out_interview_09 %></td>
        <td ><%= result.result_cash.out_full_talk_09 %></td>
        <td ><%= result.result_cash.out_get_09 %></td>
        <%#面倒くさい%>
        <td ><%= result.result_cash.out_interview_10 %></td>
        <td ><%= result.result_cash.out_full_talk_10 %></td>
        <td ><%= result.result_cash.out_get_10 %></td>
        <%#情報不足%>
        <td ><%= result.result_cash.out_interview_11 %></td>
        <td ><%= result.result_cash.out_full_talk_11 %></td>
        <td ><%= result.result_cash.out_get_11 %></td>
        <%#ペロ%>
        <td ><%= result.result_cash.out_interview_12 %></td>
        <td ><%= result.result_cash.out_full_talk_12 %></td>
        <td ><%= result.result_cash.out_get_12 %></td>
        <%#その他%>
        <td ><%= result.result_cash.out_interview_13 %></td>
        <td ><%= result.result_cash.out_full_talk_13 %></td>
        <td ><%= result.result_cash.out_get_13 %></td>
        <% end %>
      <% end %>
    <%# 楽天フェムト切り返し %>
      <% if @results.where(shift: "楽天フェムト新規").empty? %>
      <% else %>
        <% if result.result_casa.nil? %>
          <td class="td-blank"></td>
          <% 27.times do %>
          <td class="td-blank"></td>
          <% end %>
        <% else %>
        <td class="td-blank"></td>
        <% casa_out = result.result_casa %>
        <%#０１：楽天使ってない%>
        <td ><%= casa_out.out_interview_01 %></td>
        <td ><%= casa_out.out_full_talk_01 %></td>
        <td ><%= casa_out.out_get_01 %></td>
        <%#０２：めんどくさい%>
        <td ><%= casa_out.out_interview_02 %></td>
        <td ><%= casa_out.out_full_talk_02 %></td>
        <td ><%= casa_out.out_get_02 %></td>
        <%#０３：置く場所がない%>
        <td ><%= casa_out.out_interview_03 %></td>
        <td ><%= casa_out.out_full_talk_03 %></td>
        <td ><%= casa_out.out_get_03 %></td>
        <%#０４：メリットない%>
        <td ><%= casa_out.out_interview_04 %></td>
        <td ><%= casa_out.out_full_talk_04 %></td>
        <td ><%= casa_out.out_get_04 %></td>
        <%#０５：前断った%>
        <td ><%= casa_out.out_interview_05 %></td>
        <td ><%= casa_out.out_full_talk_05 %></td>
        <td ><%= casa_out.out_get_05 %></td>
        <%#０６：必要ない%>
        <td ><%= casa_out.out_interview_06 %></td>
        <td ><%= casa_out.out_full_talk_06 %></td>
        <td ><%= casa_out.out_get_06 %></td>
        <%#０７：忙しい%>
        <td ><%= casa_out.out_interview_07 %></td>
        <td ><%= casa_out.out_full_talk_07 %></td>
        <td ><%= casa_out.out_get_07 %></td>
        <%#０８：ペロ%>
        <td ><%= casa_out.out_interview_08 %></td>
        <td ><%= casa_out.out_full_talk_08 %></td>
        <td ><%= casa_out.out_get_08 %></td>
        <%#０９：そのた%>
        <td ><%= casa_out.out_interview_09 %></td>
        <td ><%= casa_out.out_full_talk_09 %></td>
        <td ><%= casa_out.out_get_09 %></td>
        <% end %>
      <% end %>
    <%# サミット切り返し %>
      </tr>
    <% end %>
    </tbody>
    </table>