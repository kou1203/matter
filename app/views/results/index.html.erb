<div data-scope-path="results/index">
  <% days = ["日", "月", "火", "水", "木", "金", "土"] %>
  <h1>利益表SS</h1>
  <%= render "shared/header" %>
    <%# 検索フォーム %>
      <%= search_form_for @q do |f| %>
      <table >
        <tr >
          <th class="search-th">獲得月</th>
          <td class="search-td"><%= f.date_select :date_during_month, {discard_day: true} ,{class: "date-input"} %></td>
          <th class="search-th">獲得期間</th>
          <td><%= f.date_field :date_gteq, class: "input" %></td>
          <td class="input" style="width:2px;">〜</td>
          <td><%= f.date_field :date_lteq, class: "input" %></td>
        </tr>
      </table>
      <table >
      <tr>
        <th class="search-th">拠点</th>
        <th class="search-th">訪問員</th>
        <th class="search-th">商材</th>
        <td class="result"><%= f.submit "絞込み" , class: "result-btn" %></td>
      </tr>
      <tr>
        <td class="search-td"><%= f.select :user_base_sub_eq, options_from_collection_for_select(User.where.not(base: "中部N").where.not(base: "関西N").where.not(base: "退職").select(:base_sub).distinct, :base_sub, :base_sub), {prompt: "全拠点"},{class: "input"} %></td>
        <td class="search-td"><%= f.text_field :user_name_cont, class: "input" %></td>
        <td class="search-td"><%= f.select :shift_eq, options_from_collection_for_select(Result.select(:shift).distinct, :shift, :shift), {prompt: "全商材"},{class: "input"} %></td>

        <td class="reset"><%= link_to "絞込みリセット", results_path, class: "reset-link" %></td>

      </tr>
      </table>
      <% end %>


    <hr>
    <% if @results.empty? %>
    <% if @result_month.empty? %>
    <% else %>
    <div >
      <div>
    <%# 現状 %>
      <table >
        <tr>
          <th colspan="2"><%= Date.today.month %>月現状</th>
        </tr>
      <%# 内容 %>
        <tr>
          <th ><%= @result_month.minimum(:date).day %>日（<%= days[@result_month.minimum(:date).wday] %>）〜<%= @result_month.maximum(:date).day %>日（<%= days[@result_month.maximum(:date).wday] %>）</th>
          <th >商材</th>
          <th >担当</th>
          <th >人員</th>
          <th >総シフト数</th>
          <th >消化シフト数</th>
          <th >必達売上</th>
          <th >現状売上</th>
          <th >実売上</th>
          <th >前月Ave</th>
          <th >前月売上</th>
          <th >現状Ave</th>
          <th >Ave前週比</th>
          <th >Ave前月比</th>
          <th >売上終着予想</th>
          <th >必達売上との差</th>
        </tr>
      <%# 中部キャッシュ %>
        <% chubu_cash_month = @result_month.includes(:user).where(users: {base: "中部SS"}).where(users: {base_sub: "キャッシュレス"}).where(shift: "キャッシュレス新規") %>
        <% chubu_cash_before_month = @result_before_month.includes(:user).where(users: {base: "中部SS"}).where(users: {base_sub: "キャッシュレス"}).where(shift: "キャッシュレス新規") %>
        <% chubu_cash_shift = Shift.includes(:user).where(year: Time.now.year ).where(month: Time.now.month).where(users: {base: "中部SS"}).where(users: {base_sub: "キャッシュレス"}) %>
        <tr>
          <th>中部</th>
          <th>キャッシュ</th>
          <th>伊藤誠一</th>
          <th><%= chubu_cash_month.group(:user_id).length %></td>
          <td ><%= Shift.includes(:user).where(year: Time.now.year ).where(month: Time.now.month).where(users: {base: "中部SS"}).where(users: {base_sub: "キャッシュレス"}).sum(:cashless_new) %></td>

          <td ><%= chubu_cash_month.length %></td>
          <td ></td>
          <td ><%= chubu_cash_month.sum(:profit).to_s(:delimited) %></td>
          <td ><%=  %></td>

          <% if @result_before_month.includes(:user).where(users: {base: "中部SS"}).empty? %>
          <td ></td>
          <td ></td>
          <% else %>
          <td ><%= chubu_cash_before_month.average(:profit).round().to_s(:delimited) %></td>

          <td ><%= chubu_cash_before_month.sum(:profit).to_s(:delimited) %></td>
          <% end %>
          <td ><%= chubu_cash_month.average(:profit).round().to_s(:delimited) rescue "計測できません" %></td>

          <td ><%= (chubu_cash_month.average(:profit).round() - @result_month.where(date: Time.now.ago(7.days)..Time.now).includes(:user).where(users: {base: "中部SS"}).where(users: {base_sub: "キャッシュレス"}).where(shift: "キャッシュレス新規").average(:profit).round()).to_s(:delimited) rescue "計測できません" %></td>

          <td ><%= (chubu_cash_month.average(:profit).round() - chubu_cash_before_month.average(:profit).round()).to_s(:delimited) rescue "計測できません" %></td>

          <td ><%= (chubu_cash_month.average(:profit) * chubu_cash_shift.sum(:cashless_new)).round().to_s(:delimited) rescue "計測できません" %></td>

          <td ></td>
        </tr>
      <%# 中部フェムト %>
        <tr>
          <th ></th>
          <th >フェムト</th>
          <th >加藤上太郎</th>
          <td ></td>
          <td ></td>
          <td ></td>
          <td ></td>
          <td ></td>
          <td ></td>
          <td ></td>
          <td ></td>
          <td ></td>
          <td ></td>
          <td ></td>
          <td ></td>
          <td ></td>
        </tr>
      <%# 東京パンダ %>
        <% tokyo_cash_month = @result_month.includes(:user).where(users: {base: "東京SS"}).where(users: {base_sub: "キャッシュ・パンダ"}).where(shift: "キャッシュレス新規").or(@result_month.includes(:user).where(users: {base: "東京SS"}).where(users: {base_sub: "キャッシュ・パンダ"}).where(shift: "パンダ")) %>

        <% tokyo_cash_before_month = @result_before_month.includes(:user).where(users: {base: "東京SS"}).where(users: {base_sub: "キャッシュ・パンダ"}).where(shift: "キャッシュレス新規").or(@result_before_month.includes(:user).where(users: {base: "東京SS"}).where(users: {base_sub: "キャッシュ・パンダ"}).where(shift: "パンダ")) %>
        
        <% tokyo_cash_shift = Shift.includes(:user).where(year: Time.now.year ).where(month: Time.now.month).where(users: {base: "東京SS"}).where(users: {base_sub: "キャッシュ・パンダ"}) %>
        <tr>
          <th >東京</th>
          <th >キャッシュ・パンダ</th>
          <th >太田将輔</th>

          <th ><%= tokyo_cash_month.group(:user_id).length %></td>

          <td ><%= tokyo_cash_shift.sum("cashless_new + panda ").to_s(:delimited) %></td>

          <td ><%= tokyo_cash_month.length %></td>
          <td ></td>
          <td ><%= tokyo_cash_month.sum(:profit).to_s(:delimited) %></td>
          <td ><%=  %></td>
          <% if tokyo_cash_before_month.empty? %>
          <td ></td>
          <td ></td>
          <% else %>

          <td ><%= tokyo_cash_before_month.average(:profit).round().to_s(:delimited) %></td>
          <td ><%= tokyo_cash_before_month.sum(:profit).to_s(:delimited) %></td>


          <% end %>
          <td ><%= tokyo_cash_month.average(:profit).round().to_s(:delimited) rescue "計測できません" %></td>

          <td ><%= (tokyo_cash_month.average(:profit).round() - tokyo_cash_month.where(date: Time.now.ago(7.days)..Time.now).average(:profit).round()).to_s(:delimited) rescue "計測できません" %></td>

          <td ><%= (tokyo_cash_month.average(:profit).round() - tokyo_cash_before_month.average(:profit).round()).to_s(:delimited) rescue "計測できません" %></td>

          <td ><%= (tokyo_cash_month.average(:profit) * tokyo_cash_shift.sum("cashless_new + panda ")).round().to_s(:delimited) rescue "計測できません" %></td>
          <td ></td>
        </tr>
      <%# 東京フェムト %>
        <tr>
          <th ></th>
          <th >フェムト</th>
          <th >矢野貴二郎</th>
          <td ></td>
          <td ></td>
          <td ></td>
          <td ></td>
          <td ></td>
          <td ></td>
          <td ></td>
          <td ></td>
          <td ></td>
          <td ></td>
          <td ></td>
          <td ></td>
          <td ></td>
        </tr>
      <%# 東京サミット %>
        <tr>
          <th ></th>
          <th >サミット</th>
          <th >横田有輝</th>
          <td ></td>
          <td ></td>
          <td ></td>
          <td ></td>
          <td ></td>
          <td ></td>
          <td ></td>
          <td ></td>
          <td ></td>
          <td ></td>
          <td ></td>
          <td ></td>
        </tr>
      <%# 関西キャッシュ %>
        <% kansai_cash_month = @result_month.includes(:user).where(users: {base: "関西SS"}).where(users: {base_sub: "キャッシュレス"}).where(shift: "キャッシュレス新規") %>
        <% kansai_cash_before_month = @result_before_month.includes(:user).where(users: {base: "関西SS"}).where(users: {base_sub: "キャッシュレス"}).where(shift: "キャッシュレス新規") %>
        <% kansai_cash_shift = Shift.includes(:user).where(year: Time.now.year ).where(month: Time.now.month).where(users: {base: "関西SS"}).where(users: {base_sub: "キャッシュレス"}) %>
        <tr>
          <th >関西</th>
          <th >キャッシュ</th>
          <th >渋谷直輝</th>
          <th ><%= kansai_cash_month.group(:user_id).length %></td>

          <td ><%= kansai_cash_shift.sum(:cashless_new) %></td>

          <td ><%= kansai_cash_month.length %></td>
          <td ></td>
          <td ><%= kansai_cash_month .sum(:profit) %></td>
          <td ><%=  %></td>
          <% if @result_before_month.includes(:user).where(users: {base: "関西SS"}).empty? %>
          <td ></td>
          <td ></td>
          <% else %>

          <td ><%= kansai_cash_before_month.average(:profit).round(1) %></td>

          <td ><%= kansai_cash_before_month.sum(:profit) %></td>

          <% end %>
          <td ><%= kansai_cash_month.average(:profit).round(1) rescue "計測できません" %></td>

          <td ><%= kansai_cash_month.average(:profit).round(1) - @result_month.where(date: Time.now.ago(7.days)..Time.now).includes(:user).where(users: {base: "関西SS"}).where(users: {base_sub: "キャッシュレス"}).where(shift: "キャッシュレス新規").average(:profit).round(1) rescue "計測できません" %></td>

          <td ><%= kansai_cash_month.average(:profit).round(1) - kansai_cash_before_month.average(:profit).round(1) rescue "計測できません" %></td>

          <td ><%= kansai_cash_month.average(:profit) * kansai_cash_shift.sum(:cashless_new) rescue "計測できません" %></td>
        </tr>
      <%# 関西フェムト %>
        <tr>
          <th ></th>
          <th >フェムト</th>
          <th >渋谷直輝</th>
          <td ></td>
          <td ></td>
          <td ></td>
          <td ></td>
          <td ></td>
          <td ></td>
          <td ></td>
          <td ></td>
          <td ></td>
          <td ></td>
          <td ></td>
          <td ></td>
          <td ></td>
        </tr>
      <%# 関西サミット %>
        <tr>
          <th ></th>
          <th >サミット</th>
          <th >星合祐甫</th>
          <td ></td>
          <td ></td>
          <td ></td>
          <td ></td>
          <td ></td>
          <td ></td>
          <td ></td>
          <td ></td>
          <td ></td>
          <td ></td>
          <td ></td>
          <td ></td>
          <td ></td>
        </tr>
      </table>
      <% end %>
    <%# 一週目 %>
      <% if @result_week1.empty? %>
      <% else %>
      <table >

      <%# 内容 %>
        <tr>
          <th >1週目</th>
        </tr>
        <tr>
          <th ><%= @result_week1.minimum(:date).day %>日（<%= days[@result_week1.minimum(:date).wday] %>）〜<%= @result_week1.maximum(:date).day %>日（<%= days[@result_week1.maximum(:date).wday] %>）</th>
          <th >商材</th>
          <th >担当</th>
          <th >人員</th>
          
          <th >消化シフト数</th>
          <th >必達売上</th>
          <th >1週目売上</th>
          <th >前月Ave</th>
          <th >前月売上</th>
          <th >一週目Ave</th>
          <th >前週Ave</th>
          <th >Ave前週比</th>
          <th >Ave前月比</th>

        </tr>
        <tr>
      <%# 中部キャッシュレス %>
        <% chubu_cash_week1 = @result_week1.includes(:user).where(users: {base: "中部SS"}).where(users: {base_sub: "キャッシュレス"}).where(shift: "キャッシュレス新規") %>
          <th >中部</th>
          <th >キャッシュ</th>
          <th >伊藤誠一</th>
          <td ><%= chubu_cash_shift.length %></td>
          
          <td ><%= chubu_cash_week1.length %></td>

          <td ></td>

          <td ><%= @result_week1.includes(:user).where(users: {base: "中部SS"}).where(users: {base_sub: "キャッシュレス"}).sum(:profit) %></td>

          <% if @result_before_month.includes(:user).where(users: {base: "中部SS"}).empty? %>
          <td ></td>
          <td ></td>
          <% else %>

          <td ><%= chubu_cash_before_month.average(:profit).round(1) %></td>

          <td ><%= chubu_cash_before_month.sum(:profit) %></td>
          <% end %>
          <td ><%= chubu_cash_week1.average(:profit).round(1) rescue "計測できません" %></td>

          <td ><%= Result.where(date: Time.now.beginning_of_month.prev_week..Time.now.beginning_of_month).includes(:user).where(users: {base: "中部SS"}).where(users: {base_sub: "キャッシュレス"}).where(shift: "キャッシュレス新規").average(:profit).round(1) rescue "計測できません" %></td>
          
          <td ><%= chubu_cash_week1.average(:profit).round(1) - Result.where(date: Time.now.beginning_of_month.prev_week..Time.now.beginning_of_month).includes(:user).where(users: {base: "中部SS"}).where(users: {base_sub: "キャッシュレス"}).where(shift: "キャッシュレス新規").average(:profit).round(1) rescue "計測できません" %></td>

          <td ><%= chubu_cash_week1.average(:profit).round(1) - chubu_cash_before_month.average(:profit).round(1) rescue "計測できません" %></td>


        </tr>
      <%# 中部フェムト %>
        <tr>
          <th ></th>
          <th >フェムト</th>
          <th >加藤上太郎</th>
          <td ></td>
          <td ></td>
          <td ></td>
          <td ></td>
          <td ></td>
          <td ></td>
          <td ></td>
          <td ></td>
          <td ></td>
          <td ></td>
          <td ></td>
          <td ></td>
        </tr>
      <%# パンダ %>
        <% tokyo_cash_week1 = @result_week1.includes(:user).where(users: {base: "東京SS"}).where(users: {base_sub: "キャッシュ・パンダ"}).where(shift: "キャッシュレス新規").or(@result_week1.includes(:user).where(users: {base: "東京SS"}).where(users: {base_sub: "キャッシュ・パンダ"}).where(shift: "パンダ")) %>
        <tr>
          <th >東京</th>
          <th >キャッシュ・パンダ</th>
          <th >太田将輔</th>
          <th ><%= tokyo_cash_shift.length %></td>

          <td ><%= tokyo_cash_week1.length %></td>
          <td ></td>
          <td ><%= tokyo_cash_week1.sum(:profit) %></td>
          <% if tokyo_cash_before_month.empty? %>
          <td ></td>
          <td ></td>
          <% else %>
          <td ><%= tokyo_cash_before_month.average(:profit).round(1) %></td>
          <td ><%= tokyo_cash_before_month.sum(:profit) %></td>
          <% end %>
          <td ><%= tokyo_cash_week1.average(:profit).round(1) rescue "計測できません" %></td>

          <td ><%= tokyo_cash_week1.where(date: Time.now.beginning_of_month.prev_week..Time.now.beginning_of_month).average(:profit).round(1) rescue "計測できません" %></td>

          <td ><%= tokyo_cash_week1.average(:profit).round(1) - tokyo_cash_week1.where(date: Time.now.beginning_of_month.prev_week..Time.now.beginning_of_month).average(:profit).round(1) rescue "計測できません" %></td>

          <td ><%= tokyo_cash_week1.average(:profit).round(1) - tokyo_cash_before_month.average(:profit).round(1) rescue "計測できません" %></td>

        </tr>
      <%# 東京フェムト %>
        <tr>
          <th ></th>
          <th >フェムト</th>
          <th >矢野貴二郎</th>
          <td ></td>
          <td ></td>
          <td ></td>
          <td ></td>
          <td ></td>
          <td ></td>
          <td ></td>
          <td ></td>
          <td ></td>
          <td ></td>
          <td ></td>
          <td ></td>
        </tr>
      <%# 東京サミット %>
        <tr>
          <th ></th>
          <th >サミット</th>
          <th >横田有輝</th>
          <td ></td>
          <td ></td>
          <td ></td>
          <td ></td>
          <td ></td>
          <td ></td>
          <td ></td>
          <td ></td>
          <td ></td>
          <td ></td>
          <td ></td>
          <td ></td>
        </tr>
      <%# 関西キャッシュ %>
        <% kansai_cash_week1 = @result_week1.includes(:user).where(users: {base: "関西SS"}).where(users: {base_sub: "キャッシュレス"}).where(shift: "キャッシュレス新規") %>
        <tr>
          <th >関西</th>
          <th >キャッシュ</th>
          <th >渋谷直輝</th>
          <th ><%= kansai_cash_shift.length %></td>

          <td ><%= kansai_cash_week1.length %></td>
          <td ></td>
          <td ><%= kansai_cash_week1.sum(:profit) %></td>
          <% if @result_before_month.includes(:user).where(users: {base: "関西SS"}).empty? %>
          <td ></td>
          <td ></td>
          <% else %>
          <td ><%= kansai_cash_before_month.average(:profit).round(1) %></td>

          <td ><%= kansai_cash_before_month.sum(:profit) %></td>

          <% end %>
          <td ><%= kansai_cash_week1.average(:profit).round(1) rescue "計測できません" %></td>

          <td ><%= Result.where(date: Time.now.beginning_of_month.prev_week..Time.now.beginning_of_month).includes(:user).where(users: {base: "関西SS"}).where(users: {base_sub: "キャッシュレス"}).average(:profit).round(1) rescue "計測できません" %></td>

          <td ><%= kansai_cash_week1.average(:profit).round(1) - Result.where(date: Time.now.beginning_of_month.prev_week..Time.now.beginning_of_month).includes(:user).where(users: {base: "関西SS"}).where(users: {base_sub: "キャッシュレス"}).average(:profit).round(1) rescue "計測できません" %></td>

          <td ><%= kansai_cash_week1.average(:profit).round(1) - kansai_cash_before_month.average(:profit).round(1) rescue "計測できません" %></td>

        </tr>
      <%# 関西フェムト %>
        <tr>
          <th ></th>
          <th >フェムト</th>
          <th >渋谷直輝</th>
          <td ></td>
          <td ></td>
          <td ></td>
          <td ></td>
          <td ></td>
          <td ></td>
          <td ></td>
          <td ></td>
          <td ></td>
          <td ></td>
          <td ></td>
          <td ></td>
        </tr>
      <%# 関西サミット %>
        <tr>
          <th ></th>
          <th >サミット</th>
          <th >星合祐甫</th>
          <td ></td>
          <td ></td>
          <td ></td>
          <td ></td>
          <td ></td>
          <td ></td>
          <td ></td>
          <td ></td>
          <td ></td>
          <td ></td>
          <td ></td>
          <td ></td>
        </tr>
      </table>
      <% end %>
    <%# 二週目 %>
      <% if @result_week2.empty? %>
      <% else %>
      <table >
        <tr>
          <th >2週目</th>
        </tr>
      <%# 内容 %>
        <tr>
          <th ><%= @result_week2.minimum(:date).day %>日（<%= days[@result_week2.minimum(:date).wday] %>）〜<%= @result_week2.maximum(:date).day %>日（<%= days[@result_week2.maximum(:date).wday] %>）</th>
          <th >商材</th>
          <th >担当</th>
          <th >人員</th>
          
          <th >消化シフト数</th>
          <th >必達売上</th>
          <th >2週目売上</th>
          <th >前月Ave</th>
          <th >前月売上</th>
          <th >2週目Ave</th>
          <th >前週Ave</th>
          <th >Ave前週比</th>
          <th >Ave前月比</th>

        </tr>
      <%# 中部キャッシュ %>
        <% chubu_cash_week2 = @result_week2.includes(:user).where(users: {base: "中部SS"}).where(users: {base_sub: "キャッシュレス"}).where(shift: "キャッシュレス新規") %>
        <tr>
          <th >中部</th>
          <th >キャッシュ</th>
          <th >伊藤誠一</th>
          <td ><%= chubu_cash_shift.length %></td>

          <td ><%= chubu_cash_week2.length %></td>
          <td ></td>
          <td ><%= chubu_cash_week2.sum(:profit) %></td>
          <% if @result_before_month.includes(:user).where(users: {base: "中部SS"}).empty? %>
          <td ></td>
          <td ></td>
          <% else %>
          <td ><%= chubu_cash_before_month.average(:profit).round(1) %></td>
          
          <td ><%= chubu_cash_before_month.sum(:profit) %></td>
          <% end %>
          <td ><%= chubu_cash_week2.average(:profit).round(1) rescue "計測できません" %></td>

          <td ><%= chubu_cash_week1.average(:profit).round(1) rescue "計測できません" %></td>

          <td ><%= chubu_cash_week2.average(:profit).round(1) - chubu_cash_week1.average(:profit).round(1) rescue "計測できません" %></td>

          <td ><%= chubu_cash_week2.average(:profit).round(1) - chubu_cash_before_month.average(:profit).round(1) rescue "計測できません" %></td>


        </tr>
      <%# 中部フェムト %>
        <tr>
          <th ></th>
          <th >フェムト</th>
          <th >加藤上太郎</th>
          <td ></td>
          <td ></td>
          <td ></td>
          <td ></td>
          <td ></td>
          <td ></td>
          <td ></td>
          <td ></td>
          <td ></td>
          <td ></td>
          <td ></td>
          <td ></td>
        </tr>
      <%# パンダ %>
        <% tokyo_cash_week2 = @result_week2.includes(:user).where(users: {base: "東京SS"}).where(users: {base_sub: "キャッシュ・パンダ"}).where(shift: "キャッシュレス新規").or(@result_week2.includes(:user).where(users: {base: "東京SS"}).where(users: {base_sub: "キャッシュ・パンダ"}).where(shift: "パンダ")) %>
        <tr>
          <th >東京</th>
          <th >キャッシュ・パンダ</th>
          <th >太田将輔</th>
          <td ><%= tokyo_cash_shift.length %></td>

          <td ><%= tokyo_cash_week2.length %></td>
          <td ></td>
          <td ><%= tokyo_cash_week2.sum(:profit) %></td>
          <% if tokyo_cash_before_month.empty? %>
          <td ></td>
          <td ></td>
          <% else %>
          <td ><%= tokyo_cash_before_month.average(:profit).round(1) %></td>
          <td ><%= tokyo_cash_before_month.sum(:profit) %></td>
          <% end %>
          <td ><%= tokyo_cash_week2.average(:profit).round(1) rescue "計測できません" %></td>
          <td ><%= tokyo_cash_week1.average(:profit).round(1) rescue "計測できません" %></td>
          <td ><%= tokyo_cash_week2.average(:profit).round(1) - tokyo_cash_week1.average(:profit).round(1) rescue "計測できません" %></td>
          <td ><%= tokyo_cash_week2.average(:profit).round(1) - tokyo_cash_before_month.average(:profit).round(1) rescue "計測できません" %></td>


        </tr>
      <%# 東京フェムト %>
        <tr>
          <th ></th>
          <th >フェムト</th>
          <th >矢野貴二郎</th>
          <td ></td>
          <td ></td>
          <td ></td>
          <td ></td>
          <td ></td>
          <td ></td>
          <td ></td>
          <td ></td>
          <td ></td>
          <td ></td>
          <td ></td>
          <td ></td>
        </tr>
      <%# 東京サミット %>
        <tr>
          <th ></th>
          <th >サミット</th>
          <th >横田有輝</th>
          <td ></td>
          <td ></td>
          <td ></td>
          <td ></td>
          <td ></td>
          <td ></td>
          <td ></td>
          <td ></td>
          <td ></td>
          <td ></td>
          <td ></td>
          <td ></td>
        </tr>
      <%# 関西キャッシュ %>
        <% kansai_cash_week2 = @result_week2.includes(:user).where(users: {base: "関西SS"}).where(users: {base_sub: "キャッシュレス"}).where(shift: "キャッシュレス新規") %>
        <tr>
          <th >関西</th>
          <th >キャッシュ</th>
          <th >渋谷直輝</th>

          <th ><%= kansai_cash_shift.length %></td>

          <td ><%= kansai_cash_week2.length %></td>
          <td ></td>
          <td ><%= kansai_cash_week2.sum(:profit) %></td>
          <% if @result_before_month.includes(:user).where(users: {base: "関西SS"}).empty? %>
          <td ></td>
          <td ></td>
          <% else %>
          <td ><%= kansai_cash_before_month.average(:profit).round(1) %></td>

          <td ><%= kansai_cash_before_month.sum(:profit) %></td>
          <% end %>
          <td ><%= kansai_cash_week2.average(:profit).round(1) rescue "計測できません" %></td>

          <td ><%= kansai_cash_week1.average(:profit).round(1) rescue "計測できません" %></td>

          <td ><%= kansai_cash_week2.average(:profit).round(1) - kansai_cash_week1.average(:profit).round(1) rescue "計測できません" %></td>
          
          <td ><%= kansai_cash_week2.average(:profit).round(1) - kansai_cash_before_month.average(:profit).round(1) rescue "計測できません" %></td>


        </tr>
        <tr>
          <th ></th>
          <th >フェムト</th>
          <th >渋谷直輝</th>
          <td ></td>
          <td ></td>
          <td ></td>
          <td ></td>
          <td ></td>
          <td ></td>
          <td ></td>
          <td ></td>
          <td ></td>
          <td ></td>
          <td ></td>
          <td ></td>
        </tr>
        <tr>
          <th ></th>
          <th >サミット</th>
          <th >星合祐甫</th>
          <td ></td>
          <td ></td>
          <td ></td>
          <td ></td>
          <td ></td>
          <td ></td>
          <td ></td>
          <td ></td>
          <td ></td>
          <td ></td>
          <td ></td>
          <td ></td>
        </tr>
      </table>
      </div>
  <%# 基準値一覧（営業マン別） %>
    <div>
    <h1>基準値一覧</h1>
  <%# キャッシュレス中部 %>
          <table >
            <tr >
              <th ><%= Date.today.month %>月早見表</th>
              <th >中部キャッシュレス</th>
            </tr>
            <tr >
              <th >担当</th>
            <% @chubu_cash.group(:user_id).each do |c| %>
              <th ><%= c.user.team %></th>
            <% end %>
            </tr>
            <tr >
              <th >名前</th>
            <% @chubu_cash.group(:user_id).each do |c| %>
              <th ><%= c.user.name %></th>
            <% end %>
            </tr>

            <tr >
              <th >現状売上</th>
            <% @chubu_cash.group(:user_id).sum(:profit).each do |c| %>
              <td class="result-ptd"><%= c[1] %></td>
            <% end %>
            </tr>

            <tr >
              <th >平均売上</th>
            <% @chubu_cash.group(:user_id).average(:profit).each do |c| %>
              <td class="result-ptd"><%= c[1].round(1) %></td>
            <% end %>
            </tr>
            <tr >
              <th >平均訪問数</th>
            <% @chubu_cash.group(:user_id).average("first_visit + latter_visit").each do |c| %>
              <td class="result-ptd"><%= c[1].round(1) %></td>
            <% end %>
            </tr>
            <tr >
              <th >平均対面数</th>
            <% @chubu_cash.group(:user_id).average("first_interview + latter_interview").each do |c| %>
              <td class="result-ptd"><%= c[1].round(1) %></td>
            <% end %>
            </tr>
            <tr >
              <th >平均フル数</th>
            <% @chubu_cash.group(:user_id).average("first_full_talk + latter_full_talk").each do |c| %>
              <td class="result-ptd"><%= c[1].round(1) %></td>
            <% end %>
            </tr>
            <tr >
              <th >平均獲得数</th>
            <% @chubu_cash.group(:user_id).average("first_get + latter_get").each do |c| %>
              <td class="result-ptd"><%= c[1].round(1) %></td>
            <% end %>
            </tr>

            <tr >
              <th >dメル獲得合計</th>
            <% @chubu_cash.group(:user_id).sum(:dmer).each do |c| %>
              <td class="result-ptd"><%= c[1] %></td>
            <% end %>
            </tr>
            <tr >
              <th >dメル獲得平均</th>
            <% @chubu_cash.group(:user_id).average(:dmer).each do |c| %>
              <td class="result-ptd"><%= c[1].round(1) %></td>
            <% end %>
            </tr>
            <tr >
              <th >aupay獲得合計</th>
            <% @chubu_cash.group(:user_id).sum(:aupay).each do |c| %>
              <td class="result-ptd"><%= c[1] %></td>
            <% end %>
            </tr>
            <tr >
              <th >aupay獲得平均</th>
            <% @chubu_cash.group(:user_id).average(:aupay).each do |c| %>
              <td class="result-ptd"><%= c[1].round(1) %></td>
            <% end %>
            </tr>
            <tr >
              <th >予定シフト数</th>
            <% @chubu_cash.group(:user_id).each do |c| %>
              <% @shifts.each do |s| %>
              <% if c.user_id == s.user_id && s.year == Date.today.year && s.month == Date.today.month %>
              <td class="result-ptd"><%= s.cashless_new %></td>
              <% end %>
              
              <% end %>
            <% end %>
            </tr>
            <tr >
              <th >消化シフト数</th>
            <% @chubu_cash.group(:user_id).count.each do |c| %>
              <td class="result-ptd"><%= c[1] %></td>
            <% end %>
            </tr>
          </table>
        <%# 中部フェムト %>
        <%# キャッシュレス関西 %>
          <table >
            <tr >
              <th ><%= Date.today.month %>月早見表</th>
              <th >関西キャッシュレス</th>
            </tr>
            <tr >
              <th >担当</th>
            <% @kansai_cash.group(:user_id).each do |c| %>
              <th ><%= c.user.team %></th>
            <% end %>
            </tr>
            <tr >
              <th >名前</th>
            <% @kansai_cash.group(:user_id).each do |c| %>
              <th ><%= c.user.name %></th>
            <% end %>
            </tr>

            <tr >
              <th >現状売上</th>
            <% @kansai_cash.group(:user_id).sum(:profit).each do |c| %>
              <td class="result-ptd"><%= c[1] %></td>
            <% end %>
            </tr>
            <tr >
              <th >平均売上</th>
            <% @kansai_cash.group(:user_id).average(:profit).each do |c| %>
              <td class="result-ptd"><%= c[1].round(1) %></td>
            <% end %>
            </tr>
            <tr >
              <th >平均訪問数</th>
            <% @kansai_cash.group(:user_id).average("first_visit + latter_visit").each do |c| %>
              <td class="result-ptd"><%= c[1].round(1) %></td>
            <% end %>
            </tr>
            <tr >
              <th >平均対面数</th>
            <% @kansai_cash.group(:user_id).average("first_interview + latter_interview").each do |c| %>
              <td class="result-ptd"><%= c[1].round(1) %></td>
            <% end %>
            </tr>
            <tr >
              <th >平均フル数</th>
            <% @kansai_cash.group(:user_id).average("first_full_talk + latter_full_talk").each do |c| %>
              <td class="result-ptd"><%= c[1].round(1) %></td>
            <% end %>
            </tr>
            <tr >
              <th >平均獲得数</th>
            <% @kansai_cash.group(:user_id).average("first_get + latter_get").each do |c| %>
              <td class="result-ptd"><%= c[1].round(1) %></td>
            <% end %>
            </tr>

            <tr >
              <th >dメル獲得合計</th>
            <% @kansai_cash.group(:user_id).sum(:dmer).each do |c| %>
              <td class="result-ptd"><%= c[1] %></td>
            <% end %>
            </tr>
            <tr >
              <th >dメル獲得平均</th>
            <% @kansai_cash.group(:user_id).average(:dmer).each do |c| %>
              <td class="result-ptd"><%= c[1].round(1) %></td>
            <% end %>
            </tr>
            <tr >
              <th >aupay獲得合計</th>
            <% @kansai_cash.group(:user_id).sum(:aupay).each do |c| %>
              <td class="result-ptd"><%= c[1] %></td>
            <% end %>
            </tr>
            <tr >
              <th >aupay獲得平均</th>
            <% @kansai_cash.group(:user_id).average(:aupay).each do |c| %>
              <td class="result-ptd"><%= c[1].round(1) %></td>
            <% end %>
            </tr>
            <tr >
              <th >予定シフト数</th>
            <% @kansai_cash.group(:user_id).each do |c| %>
              <% @shifts.each do |s| %>
              <% if c.user_id == s.user_id && s.year == Date.today.year && s.month == Date.today.month %>
              <td class="result-ptd"><%= s.cashless_new %></td>
              <% end %>
              
              <% end %>
            <% end %>
            </tr>
            <tr >
              <th >消化シフト数</th>
            <% @kansai_cash.group(:user_id).count.each do |c| %>
              <td class="result-ptd"><%= c[1] %></td>
            <% end %>
            </tr>
          </table>
        <%# 関西サミット %>
        <%# 関西フェムト %>
        <%# 東京キャッシュレス・パンダ %>
          <table >
            <tr >
              <th ><%= Date.today.month %>月早見表</th>
              <th >東京キャッシュ・パンダ</th>
            </tr>
            <tr >
              <th >担当</th>
            <% @tokyo_cash.group(:user_id).each do |c| %>
              <th ><%= c.user.team %></th>
            <% end %>
            </tr>
            <tr >
              <th >名前</th>
            <% @tokyo_cash.group(:user_id).each do |c| %>
              <th ><%= c.user.name %></th>
            <% end %>
            </tr>

            <tr >
              <th >現状売上</th>
            <% @tokyo_cash.group(:user_id).sum(:profit).each do |c| %>
              <td class="result-ptd"><%= c[1] %></td>
            <% end %>
            </tr>
            <tr >
              <th >平均売上</th>
            <% @tokyo_cash.group(:user_id).average(:profit).each do |c| %>
              <td class="result-ptd"><%= c[1].round(1) %></td>
            <% end %>
            </tr>
            <tr >
              <th >平均訪問数</th>
            <% @tokyo_cash.group(:user_id).average("first_visit + latter_visit").each do |c| %>
              <td class="result-ptd"><%= c[1].round(1) %></td>
            <% end %>
            </tr>
            <tr >
              <th >平均対面数</th>
            <% @tokyo_cash.group(:user_id).average("first_interview + latter_interview").each do |c| %>
              <td class="result-ptd"><%= c[1].round(1) %></td>
            <% end %>
            </tr>
            <tr>
              <th >平均フル数</th>
            <% @tokyo_cash.group(:user_id).average("first_full_talk + latter_full_talk").each do |c| %>
              <td class="result-ptd"><%= c[1].round(1) %></td>
            <% end %>
            </tr>
            <tr >
              <th >平均獲得数</th>
            <% @tokyo_cash.group(:user_id).average("first_get + latter_get").each do |c| %>
              <td class="result-ptd"><%= c[1].round(1) %></td>
            <% end %>
            </tr>

            <tr >
              <th >dメル獲得合計</th>
            <% @tokyo_cash.group(:user_id).sum(:dmer).each do |c| %>
              <td class="result-ptd"><%= c[1] %></td>
            <% end %>
            </tr>
            <tr >
              <th >dメル獲得平均</th>
            <% @tokyo_cash.group(:user_id).average(:dmer).each do |c| %>
              <td class="result-ptd"><%= c[1].round(1) %></td>
            <% end %>
            </tr>
            <tr >
              <th >aupay獲得合計</th>
            <% @tokyo_cash.group(:user_id).sum(:aupay).each do |c| %>
              <td class="result-ptd"><%= c[1] %></td>
            <% end %>
            </tr>
            <tr >
              <th >aupay獲得平均</th>
            <% @tokyo_cash.group(:user_id).average(:aupay).each do |c| %>
              <td class="result-ptd"><%= c[1].round(1) %></td>
            <% end %>
            </tr>
            <tr >
              <th >パンダ獲得合計</th>
            <% @tokyo_cash.group(:user_id).sum(:panda).each do |c| %>
              <td class="result-ptd"><%= c[1] %></td>
            <% end %>
            </tr>
            <tr >
              <th >パンダ獲得平均</th>
            <% @tokyo_cash.group(:user_id).average(:panda).each do |c| %>
              <td class="result-ptd"><%= c[1].round(1) %></td>
            <% end %>
            </tr>
            <tr >
              <th >予定シフト数</th>
            <% @tokyo_cash.group(:user_id).each do |c| %>
              <% @shifts.each do |s| %>
              <% if c.user_id == s.user_id && s.year == Date.today.year && s.month == Date.today.month %>
              <td class="result-ptd"><%= s.cashless_new + s.panda %></td>
              <% end %>
              
              <% end %>
            <% end %>
            </tr>
            <tr >
              <th >消化シフト数</th>
            <% @tokyo_cash.group(:user_id).count.each do |c| %>
              <td class="result-ptd"><%= c[1] %></td>
            <% end %>
            </tr>
          </table>
        <%# 東京サミット %>
        <%# 東京フェムト %>
      </div>
    </div>
      <% end %>
    <% else %>
    <% if @results.group(:user_id).length != 1 %>
      <h1 class="warning">※訪問員の名前を入力してください,もしくは対象訪問員が複数います。</h1>
      <h1>表示可能な訪問員</h1>
      <% @results.group("MONTH('date')").group(:user_id).each do |result| %>
        <h1>・<%= result.user.name %></h1>
      <% end %>
    <% else %>
    <%# 個別利益表 %>
      <h1>表示範囲：<%= @results.minimum(:date) %>（<%= days[@results.minimum(:date).wday] %>）〜<%= @results.maximum(:date) %>（<%= days[@results.maximum(:date).wday] %>）</h1>
      <h1>
        <% @results.each do |result| %>
          拠点：
          <%= result.user.base %>
          <%= result.user.base_sub %>
          <%= result.user.name %>
      </h1>
  <div >
    <%# シフト %>
      <table >
        <tr >
          <th >シフト（メイン商材）</th>
          <th >予定</th>
          <th >消化</th>
          <th >残シフト</th>
          <th >欠勤</th>
        </tr>
        <tr class="result-shit-tr">
          <% new_shift = 0 %>
          <% settlement_shift = 0 %>
          <% summit_shift = 0 %>
          <% casa_shift = 0 %>
          <% casa_put_shift = 0 %>
          <% panda_shift = 0 %>
          <% ojt_shift = 0 %>
          <% house_work_shift = 0 %>
          <% @shifts.each do |shift| %>
            <% if shift.year == result.date.year && shift.month == result.date.month && shift.user.name == result.user.name %>
              <% new_shift = shift.cashless_new %>
              <% settlement_shift = shift.cashless_settlement %>
              <% summit_shift = shift.summit %>
              <% casa_shift = shift.rakuten_casa %>
              <% casa_put_shift= shift.rakuten_casa_put %>
              <% panda_shift = shift.panda %>
              <% ojt_shift = shift.ojt %>
              <% house_work_shift = shift.house_work %> 
            <% end %>
          <% end %>
        </tr>
        <tr class="result-shit-tr">
          <th >キャッシュレス新規</th><%# 欠勤 %>
              <td ><%= new_shift %></td>
              <td ><%= digestion_new = @results.where(shift: "キャッシュレス新規").length %></td>
              <td ><%= new_shift - digestion_new %></td>
              <td style="color:red; font-weight:bold;"><%= absence = @results.where(shift: "欠勤").length %></td>
          </tr>
        <tr class="result-shit-tr">
          <th >キャッシュレス決済</th>
              <td ><%= settlement_shift %></td>
              <td ><%= digestion_settlement = @results.where(shift: "キャッシュレス決済").length %></td>
              <td ><%= settlement_shift - digestion_settlement %></td>
        </tr>
        <tr class="result-shit-tr">
          <th >サミット</th>
              <td ><%= summit_shift %></td>
              <td ><%= digestion_summit = @results.where(shift: "サミット").length %></td>
              <td ><%= summit_shift - digestion_summit %></td>
        </tr>
        <tr class="result-shit-tr">
          <th >パンダ</th>
              <td ><%= panda_shift %></td>
              <td ><%= digestion_panda = @results.where(shift: "パンダ").length %></td>
              <td ><%= panda_shift - digestion_panda %></td>
        </tr>
        <tr class="result-shit-tr">
          <th >フェムト</th>
              <td ><%= casa_shift %></td>
              <td ><%= digestion_casa = @results.where(shift: "フェムト").length %></td>
              <td ><%= casa_shift - digestion_casa %></td>
        </tr>
        <tr class="result-shit-tr">
          <th >フェムト（設置）</th>
              <td ><%= casa_put_shift %></td>
              <td ><%= digestion_casa_put = @results.where(shift: "フェムト（設置）").length %></td>
              <td ><%= casa_put_shift - digestion_casa_put %></td>
        </tr>
        <tr class="result-shit-tr">
          <th >帯同</th>
              <td ><%= ojt_shift %></td>
              <td ><%= digestion_ojt = @results.where(shift: "帯同").length %></td>
              <td ><%= ojt_shift - digestion_ojt %></td>
        </tr>
        <tr class="result-shit-tr">
          <th >内勤</th>
              <td ><%= house_work_shift %></td>
              <td ><%= digestion_house_work = @results.where(shift: "内勤").length %></td>
              <td ><%= house_work_shift - digestion_house_work %></td>
        </tr>
        <tr class="result-shit-tr">
          <th >合計</th>
              <td ><%= shift_sum = new_shift + settlement_shift + summit_shift + panda_shift + casa_shift + casa_put_shift + ojt_shift + house_work_shift %></td>
              <td ><%= digestion_sum = digestion_new + digestion_settlement + digestion_summit + digestion_panda + digestion_casa + digestion_casa_put + digestion_ojt + digestion_house_work + absence %></td>
              <td ><%= shift_sum - digestion_sum %></td>
        </tr>
      </table>
      <% if shift_sum == 0 %>
        <h2 class="warning">予定シフトがありません。シフト申請を行ってください</h2>
      <% end %>
      
    <%# 基準値 %>
      <%# 総合基準値ラベル %>
        <table >
        <tr>
          <th colspan="2">基準値</th>
        </tr>
        <tr>
          <th ></th>
          <th >平均売上</th>
          <th >現状売上</th>
          <th >予想終着</th>
          <th >訪問数</th>
          <th >対面率</th>
          <th >対面数</th>
          <th >フル率</th>
          <th >フル数</th>
          <th >成約率</th>
          <th >平均獲得数</th>
        </tr>
          <% basic_results = @results.where.not(shift: "キャッシュレス決済").where.not(shift: "内勤").where.not(shift: "帯同").where.not(shift: "フェムト（設置）") %>
          <% visit = basic_results.sum(:first_visit).to_f + basic_results.sum(:latter_visit).to_f %>
          <% interview = basic_results.sum(:first_interview).to_f + basic_results.sum(:latter_interview).to_f %>
          <% full_talk = basic_results.sum(:first_full_talk).to_f + basic_results.sum(:latter_full_talk).to_f %>
          <% get = basic_results.sum(:first_get).to_f + basic_results.sum(:latter_get).to_f %>
          <% cash_ave = @results.where(shift: "キャッシュレス新規").average(:profit).round() rescue 0 %>
          <% settlement_ave = @results.where(shift: "キャッシュレス決済").average(:profit).round() rescue 0 %>
          <% panda_ave = @results.where(shift: "パンダ").average(:profit).round() rescue 0 %>
          <% casa_ave = @results.where(shift: "フェムト").average(:profit).round() rescue 0 %>
      <%# 総合基準値値 %>
        <tr>
          <th style="border-bottom:solid 0.5px white;">（全商材合計）</th>
          <td ><%= @results.where.not(shift: "内勤").where.not(shift: "帯同").where.not(shift: "休み").where.not(shift: "欠勤").average(:profit).round().to_s(:delimited) rescue 0 %></td>
          <td ><%= @results.sum(:profit).to_s(:delimited) %></td>
          <% if shift_sum == 0 %>
          <td>シフトを入力してください</td>
          <% else %>
          <td ><%= (cash_ave * new_shift + settlement_ave * settlement_shift + panda_ave * panda_shift).to_s(:delimited) %></td>
          <% end %>
          <td ><%= ( visit / basic_results.length).round(1) %></td>
          <td ><%= number_to_percentage(interview / visit * 100, precision: 1) rescue 0 %></td>
          <td ><%=  (interview / @results.length).round(1) %></td>
          <td ><%= number_to_percentage(full_talk / interview * 100 , precision: 1) rescue 0 %></td>
          <td ><%= ( full_talk / basic_results.length).round(1) %></td>
          <td ><%= number_to_percentage(get / full_talk * 100, precision: 1) rescue 0 %></td>
          <td ><%= ( get / basic_results.length).round(1) rescue 0 %></td>
        </tr>
      <%# キャッシュレス基準値早見表 %>
        <% if @results.where(shift: "キャッシュレス新規").empty? %>
        <% else %>
        <tr >
          <th >キャッシュレス</th>
          <th >平均売上</th>
          <th >現状売上</th>
          <th >予想終着</th>
          <th >dメル獲得数</th>
          <th >aupay獲得数</th>
          <th >paypay獲得数</th>

        </tr>

        <tr>
          <th style="border-bottom: solid 0.5px white;">新規</th>
          <td ><%= cash_ave.to_s(:delimited) %></td>
          <td ><%= @results.where(shift: "キャッシュレス新規").sum(:profit).to_s(:delimited) %></td>
          <% if new_shift == 0 %>
          <td >シフトを入力してください</td>
          <% else %>
          <td ><%= (cash_ave * new_shift).to_s(:delimited) %></td>
          <% end %>
          <td ><%= @results.where(shift: "キャッシュレス新規").sum(:dmer) %></td>
          <td ><%= @results.where(shift: "キャッシュレス新規").sum(:aupay) %></td>
          <td ><%= @results.where(shift: "キャッシュレス新規").sum(:paypay) %></td>
        </tr>
      <%# キャッシュレス決済 %>
        <% if @results.where(shift: "キャッシュレス決済").empty? %>
        <% else %>
        <tr>
          <th style="border-bottom:solid 0.5px white;">決済</th>
          <td ><%= settlement_ave.to_s(:delimited) %></td>
          <td ><%= @results.where(shift: "キャッシュレス決済").sum(:profit).to_s(:delimited) %></td>
          <% if settlement_shift == 0 %>
          <td >シフトを入力してください</td>
          <% else %> 
          <td ><%= (settlement_ave * settlement_shift).to_s(:delimited) %></td>
          <% end %>
        </tr>
        <% end %>
        
      <%# キャッシュレス成約率 %>
        <tr >
          <th ></th>
          <th >どういうこと？</th>
          <th >君は誰？教会？</th>
          <th >もらうだけでいいの？</th>
          <th >PayPayのみ</th>
          <th >AirPayのみ</th>
          <th >カードのみ</th>
          <th >先延ばし</th>
        </tr>
        <tr >
          <th>切り返し</th>
          <td ><%= number_to_percentage(@results.sum(:cashless_what_get).to_f / @results.sum(:cashless_what_full_talk) *100,precision: 1) rescue 0 %></td>
          <td ><%= number_to_percentage(@results.sum(:cashless_who_get).to_f / @results.sum(:cashless_who_full_talk) *100,precision: 1) rescue 0 %></td>
          <td ><%= number_to_percentage(@results.sum(:cashless_just_get_get).to_f / @results.sum(:cashless_just_get_full_talk) *100,precision: 1) rescue 0 %></td>
          <td ><%= number_to_percentage(@results.sum(:cashless_paypay_only_get).to_f / @results.sum(:cashless_paypay_only_full_talk) *100,precision: 1) rescue 0 %></td>
          <td ><%= number_to_percentage(@results.sum(:cashless_airpay_only_get).to_f / @results.sum(:cashless_airpay_only_full_talk) *100,precision: 1) rescue 0 %></td>

          <td ><%= number_to_percentage(@results.sum(:cashless_card_only_get).to_f / @results.sum(:cashless_card_only_full_talk) *100,precision: 1) rescue 0 %></td>
          <td ><%= number_to_percentage(@results.sum(:cashless_yet_get).to_f / @results.sum(:cashless_yet_full_talk) *100,precision: 1) rescue 0 %></td>
        </tr>
        <tr >
          <th ></th>
          <th >現金のみ</th>
          <th >忙しい</th>
          <th >面倒くさい</th>
          <th >情報不足</th>
          <th >ペロ</th>
          <th >その他</th>
        </tr>
        <tr>
          <th style="border-bottom:solid 0.5px white;"></th>
          <td ><%= number_to_percentage(@results.sum(:cashless_cash_only_get).to_f / @results.sum(:cashless_cash_only_full_talk) *100,precision: 1) rescue 0 %></td>
          <td ><%= number_to_percentage(@results.sum(:cashless_busy_get).to_f / @results.sum(:cashless_busy_full_talk) *100,precision: 1) rescue 0 %></td>
          <td ><%= number_to_percentage(@results.sum(:cashless_dull_get).to_f / @results.sum(:cashless_dull_full_talk) *100,precision: 1) rescue 0 %></td>
          <td ><%= number_to_percentage(@results.sum(:cashless_lack_info_get).to_f / @results.sum(:cashless_lack_info_full_talk) *100,precision: 1) rescue 0 %></td>
          <td ><%= number_to_percentage(@results.sum(:cashless_easy_get).to_f / @results.sum(:cashless_easy_full_talk) *100,precision: 1) rescue 0 %></td>
          <td ><%= number_to_percentage(@results.sum(:cashless_other_get).to_f / @results.sum(:cashless_other_full_talk) *100,precision: 1) rescue 0 %></td>
        </tr>
          <% end %>
      <%# フェムト基準値早見表 %>
        <% if @results.where(shift: "フェムト").empty? %>
        <% else %>
        <tr>
          <th>フェムト</th>
          <th >平均売上</th>
          <th >現状売上</th>
          <th >予想終着</th>
          <th >フェムト平均獲得数</th>
          <th >フェムト現状獲得数</th>
          <th >フェムト現状設置数</th>
        </tr>
        <tr>
          <th style="border-bottom:solid 0.5px white;"></th>
          <td><%= casa_ave.to_s(:delimited) %></td>
          <td><%= @results.where(shift: "フェムト").sum(:profit).to_s(:delimited) %></td>
          <% if casa_shift == 0 %>
          <td>予定シフトが入力されていません</td>
          <% else %>
          <td ><%=  (casa_ave * casa_shift).to_s(:delimited) %></td>
          <% end %>
          <td ><%= @results.where(shift: "フェムト").average(:rakuten_casa).round(1) %></td>
          <td ><%= @results.where(shift: "フェムト").sum(:rakuten_casa).round(1) %></td>
          <td ><%= @results.where(shift: "フェムト（設置）").sum(:rakuten_casa_put).round(1) %></td>
        </tr>
      <%# フェムト切り返し %>
        <tr>
          <th></th>
          <th>忙しい</th>
          <th>面倒くさい</th>
          <th>置く場所がない</th>
          <th>メリットがない</th>
          <th>不審</th>
          <th>回線を使われたくない</th>
          <th>結構です</th>
          <th>ペロ</th>
          <th>その他</th>
        </tr>
        <tr>
          <th></th>
          <td><%= number_to_percentage(@results.sum(:casa_dull_get).to_f / @results.sum(:casa_dull_full_talk).to_f * 100,precision: 1) rescue 0 %></td>
          <td><%= number_to_percentage(@results.sum(:casa_dull_get).to_f / @results.sum(:casa_dull_full_talk).to_f * 100,precision: 1) rescue 0 %></td>
          <td><%= number_to_percentage(@results.sum(:casa_no_merit_get).to_f / @results.sum(:casa_not_put_space_full_talk).to_f * 100,precision: 1) rescue 0 %></td>
          <td><%= number_to_percentage(@results.sum(:casa_no_merit_get).to_f / @results.sum(:casa_not_put_space_full_talk).to_f * 100,precision: 1) rescue 0 %></td>
          <td><%= number_to_percentage(@results.sum(:casa_distrust_get).to_f / @results.sum(:casa_distrust_full_talk).to_f * 100,precision: 1) rescue 0 %></td>
          <td><%= number_to_percentage(@results.sum(:casa_not_use_net_get).to_f / @results.sum(:casa_not_use_net_full_talk).to_f * 100,precision: 1) rescue 0 %></td>
          <td><%= number_to_percentage(@results.sum(:casa_not_need_get).to_f / @results.sum(:casa_not_need_full_talk).to_f * 100,precision: 1) rescue 0 %></td>
          <td><%= number_to_percentage(@results.sum(:casa_easy_get).to_f / @results.sum(:casa_easy_full_talk).to_f * 100,precision: 1) rescue 0 %></td>
          <td><%= number_to_percentage(@results.sum(:casa_other_get).to_f / @results.sum(:casa_other_full_talk).to_f * 100,precision: 1) rescue 0 %></td>
        </tr>
        <% end %>
      <%# パンダ成約率 %>
        <% if @results.where(shift: "パンダ").empty? %>
        <% else %>
        <tr>
          <th >パンダ</th>
          <th >平均売上</th>
          <th >現状売上</th>
          <th >予想終着</th>
          <th >パンダ平均獲得数</th>
        </tr>
        <tr>
          <th style="border-bottom:solid 0.5px white;"></th>
          <td ><%= panda_ave.to_s(:delimited) %></td>
          <td ><%= @results.where(shift: "パンダ").sum(:profit).to_s(:delimited) %></td>
          <% if panda_shift == 0 %>
          <td >パンダシフトがありません</td>
          <% else %>
          <td ><%=  (panda_ave * panda_shift).to_s(:delimited) %></td>
          <% end %>
          <td ><%= @results.average(:panda).round(1) %></td>
        </tr>
        <tr>
          <th></th>
          <th >結構です</th>
          <th >忙しい</th>
          <th >検討する</th>
          <th >デリバリーはいい</th>
          <th >増やしたくない</th>
        </tr>
        <tr>
          <th >パンダ切り返し</th>
          <td ><%= number_to_percentage(@results.sum(:panda_not_need_get).to_f / @results.sum(:panda_not_need_full_talk) * 100,precision: 1) rescue 0 %></td>
          <td ><%= number_to_percentage(@results.sum(:panda_busy_get).to_f / @results.sum(:panda_busy_full_talk) * 100,precision: 1) rescue 0 %></td>
          <td ><%= number_to_percentage(@results.sum(:panda_yet_get).to_f / @results.sum(:panda_yet_full_talk) * 100,precision: 1) rescue 0 %></td>
          <td ><%= number_to_percentage(@results.sum(:panda_not_delivery_get).to_f / @results.sum(:panda_not_delivery_full_talk) * 100,precision: 1) rescue 0 %></td>
          <td ><%= number_to_percentage(@results.sum(:panda_not_increment_get).to_f / @results.sum(:panda_not_increment_full_talk) * 100,precision: 1) rescue 0 %></td>
        </tr>
        
        <tr>
          <th ></th>
          <th >やる余裕がない</th>
          <th >面倒くさい</th>
          <th >情報不足</th>
          <th >フードネコ</th>
          <th >ペロ</th>
          <th >その他</th>
        </tr>

        <tr>
          <th ></th>
          <td ><%= number_to_percentage(@results.sum(:panda_not_margin_get).to_f / @results.sum(:panda_not_margin_full_talk) * 100,precision: 1) rescue 0 %></td>
          <td ><%= number_to_percentage(@results.sum(:panda_dull_get).to_f / @results.sum(:panda_dull_full_talk) * 100,precision: 1) rescue 0 %></td>
          <td ><%= number_to_percentage(@results.sum(:panda_lack_info_get).to_f / @results.sum(:panda_lack_info_full_talk) * 100,precision: 1) rescue 0 %></td>
          <td ><%= number_to_percentage(@results.sum(:panda_food_neko_get).to_f / @results.sum(:panda_food_neko_full_talk) * 100,precision: 1) rescue 0 %></td>
          <td ><%= number_to_percentage(@results.sum(:panda_easy_get).to_f / @results.sum(:panda_easy_full_talk) * 100,precision: 1) rescue 0 %></td>

          <td ><%= number_to_percentage(@results.sum(:panda_other_get).to_f / @results.sum(:panda_other_full_talk) * 100,precision: 1) rescue 0 %></td>
        </tr>
        </table>
        <% end %>
      
    <%# サミット使用量、従量など %>
        <% if @results.where(shift: "サミット").empty? %>
        <% else %>
        <table >
          <tr >
              <% amount_sum = 0 %>
              <% metered_lamp_sum = 0 %>
              <% low_voltage_sum = 0 %>
              <% summit_shift = 0 %>
          <% @summits.where(contract_type: "低圧電力").each do |summit| %>
            <% if summit.get_date.year == result.date.year && summit.get_date.month == result.date.month && summit.get_date.day == result.date.day && summit.user.name == result.user.name %>
              <% low_voltage_sum += summit.contract_cap %>
              <% amount_sum += summit.amount_use %>
              <% summit_shift += 1 %>
            <% end %>
          <% end %>
          <% @summits.where.not(contract_type: "低圧電力").each do |summit| %>
            <% if summit.get_date.year == result.date.year && summit.get_date.month == result.date.month && summit.user.name == result.user.name %>
              <% metered_lamp_sum += summit.contract_cap %>
              <% amount_sum += summit.amount_use %>
              <% summit_shift += 1 %>
            <% end %> 
          <% end %>

          <tr class="">
            <th >サミット月間獲得</th>
          </tr>
          <tr class="">
            <th >内訳</th>
            <th >従量電灯</th>
            <th >低圧電力</th>
            <th >使用量</th>
            <th >獲得件数</th>
          </tr>
          <tr class="">
            <th >合計</th>
            <td ><%= metered_lamp_sum %>kWh</td>
            <td ><%= low_voltage_sum %>kW</td>
            <td ><%= amount_sum %>kWh</td>
            <td ><%= summit_shift %></td>
          </tr>

          <tr class="">
            <th >平均</th>
            <td ><%= metered_lamp_sum / summit_shift rescue 0 %>kWh</td>
            <td ><%= low_voltage_sum / summit_shift rescue 0 %>kW</td>
            <td ><%= amount_sum / summit_shift rescue 0 %>kWh</td>
            <td ></td>

          </tr>
    <%# サミット成約率 %>
        <tr>
          <th >サミット成約率</th>
          <th >引き落とし拒否</th>
          <th >忙しい</th>
          <th >怪しい</th>
          <th >検討したい</th>
          <th >変えたくない</th>
          <th >その他</th>
          <th >ペロ</th>
        </tr>
        <tr>
          <td ></td>
          <td ><%= number_to_percentage(@results.sum(:summit_reject_cash_get).to_f / @results.sum(:summit_reject_cash_full_talk) *100,precision: 1) rescue 0 %></td>
          <td ><%= number_to_percentage(@results.sum(:summit_busy_get).to_f / @results.sum(:summit_busy_full_talk) * 100, precision: 1) rescue 0 %></td>
          <td ><%= number_to_percentage(@results.sum(:summit_doubt_get).to_f / @results.sum(:summit_doubt_full_talk) * 100, precision: 1) rescue 0 %></td>
          <td ><%= number_to_percentage(@results.sum(:summit_yet_get).to_f / @results.sum(:summit_yet_get) * 100,precision: 1) rescue 0 %></td>
          <td ><%= number_to_percentage(@results.sum(:summit_not_change_get).to_f / @results.sum(:summit_not_change_get) * 100,precision: 1) rescue 0 %></td>
          <td ><%= number_to_percentage(@results.sum(:summit_other_get).to_f / @results.sum(:summit_other_full_talk) * 100, precision: 1) rescue 0 %></td>
          <td ><%= number_to_percentage(@results.sum(:summit_easy_get).to_f / @results.sum(:summit_easy_full_talk) * 100,precision: 1) rescue 0 %></td>
        </tr>
        </table>
        <% end %>
      

        <% break %>
        <% end %>
  </div>
    <%#帯同%>
        <table class="n-result-table">
        <% if @results.where.not(ojt: "").empty? %>
        <% else %>
          <% @results.where.not(ojt: "").each do |result| %>
            <% ojt_prev = @results.where(date: result.date.prev_week..result.date.ago(1.days)).where.not(shift: 'キャッシュレス決済') %>
            <% ojt_next = @results.where(date: result.date.tomorrow..result.date.next_week).where.not(shift: 'キャッシュレス決済') %>
            <% ojt_date = result.date %>
            <% week_prev = result.date.prev_week %>
            <% week_next = result.date.next_week %>
          <tr >
            <th >帯同</th>
            <th >対策員：</th>
            <th ><%= result.user.name %></th>
            <th >帯同者：</th>
            <th ><%= result.ojt %></th>
          </tr>
          <tr >
            <th style="border-bottom: solid 0.5px white;"></th>
            <th >平均売上</th>
            <th >訪問</th>
            <th >対面</th>
            <th >フル</th>
            <th >獲得</th>
            <th >確認期間</th>
          <%# 帯同日 %>
          <tr >
              <th style="border-bottom: solid 0.5px white;">帯同日</th>
              <td ><%= result.profit.to_s(:delimited) %></td>
              <td ><%= result.first_visit + result.latter_visit %></td>
              <td ><%= result.first_interview + result.latter_interview %></td>
              <td ><%= result.first_full_talk + result.latter_full_talk %></td>
              <td ><%= result.first_get + result.latter_get %></td>
              <td ><%= result.date.month %>月<%= result.date.day %>日</td>
          </tr>
          <%# 帯同前 %>
            <tr >
              <th style="border-bottom: solid 0.5px white;">帯同前</th>
              <% if ojt_prev.empty? %>
              <td ><%= ojt_prev_profit = "確認対象なし" %></td>
              <td colspan="4"></td>
              <% else %>
              <% ojt_prev_profit = ojt_prev.average(:profit).round() %>
              <td ><%= ojt_prev_profit.to_s(:delimited) %></td>
              <td ><%= ojt_prev_visit = ojt_prev.average(:first_visit).round(1) + ojt_prev.average(:latter_visit).round(1) %></td>
              <td ><%= ojt_prev_interview = ojt_prev.average(:first_interview).round(1) + ojt_prev.average(:latter_interview).round(1) %></td>
              <td ><%= ojt_prev_full_talk = ojt_prev.average(:first_full_talk).round(1) + ojt_prev.average(:latter_full_talk).round(1) %></td>
              <td ><%= ojt_prev_get = ojt_prev.average(:first_get).round(1) + ojt_prev.average(:latter_get).round(1) %></td>
              <% end %>
              <td ><%= week_prev.month %>月<%= week_prev.day%>日〜<%= ojt_date.month %>月<%= ojt_date.ago(1.days).day %>日</td>
            </tr>
          <%# 帯同後 %>
            <tr >
              <th style="border-bottom: solid 0.5px white;">帯同後</th>
              <% if ojt_next.empty? %>
              <td ><%= ojt_prev_profit = "確認対象なし" %></td>
              <td ></td>
              <td ></td>
              <td ></td>
              <td ></td>
              <% else %>
              <% ojt_next_profit = ojt_next.average(:profit).round() %>
              <td ><%= ojt_next_profit.to_s(:delimited) %></td>
              <td ><%= ojt_next_visit = ojt_next.average(:first_visit).round(1) + ojt_next.average(:latter_visit).round(1) %></td>
              <td ><%= ojt_next_interview = ojt_next.average(:first_interview).round(1) + ojt_next.average(:latter_interview).round(1) %></td>
              <td ><%= ojt_next_full_talk = ojt_next.average(:first_full_talk).round(1) + ojt_next.average(:latter_full_talk).round(1) %></td>
              <td ><%= ojt_next_get = ojt_next.average(:first_get).round(1) + ojt_next.average(:latter_get).round(1) %></td>
              <td ><%= ojt_date.tomorrow.month %>月<%= ojt_date.tomorrow.day %>日〜<%= week_next.month %>月<%= week_next.day %>日</td>
            </tr>
            <% end %>
          <%# 帯同結果 %>
            <tr>
            <% if ojt_prev.empty? || ojt_next.empty? %>
            <% else %>
              <th >帯同結果</th>
              <% if ojt_next_profit >= ojt_prev_profit %>
              <td style="color: blue; font-weight: bold;"> ＋<%= (ojt_next_profit - ojt_prev_profit).to_s(:delimited) %></td>
              <% else %>
              <td style="color: red;"><%= (ojt_next_profit - ojt_prev_profit).to_s(:delimited) %></td>
              <% end %>
              <% if ojt_next_visit >= ojt_prev_visit %>
              <td style="color: blue; font-weight: bold;"> ＋<%= ojt_next_visit - ojt_prev_visit %></td>
              <% else %>
              <td style="color: red;"><%= ojt_next_visit - ojt_prev_visit %></td>
              <% end %>
              <% if ojt_next_interview >= ojt_prev_interview %>
              <td style="color: blue; font-weight: bold;"> ＋<%= ojt_next_interview - ojt_prev_interview %></td>
              <% else %>
              <td style="color: red;"><%= ojt_next_interview - ojt_prev_interview %></td>
              <% end %>
              <% if ojt_next_full_talk >= ojt_prev_full_talk %>
              <td style="color: blue; font-weight: bold;"> ＋<%= ojt_next_full_talk - ojt_prev_full_talk %></td>
              <% else %>
              <td style="color: red;"><%= ojt_next_full_talk - ojt_prev_full_talk %></td>
              <% end %>
              <% if ojt_next_get >= ojt_prev_get %>
              <td style="color: blue; font-weight: bold;"> ＋<%= ojt_next_get - ojt_prev_get %></td>
              <% else %>
              <td style="color: red;"><%= ojt_next_get - ojt_prev_get %></td>
              <% end %>

            <% end %>
            </tr>
          <% end %>
          <% end %>
          </table>
  
    <%# 日々終着一覧（見出し） %>
      <table >
      <%# 総合 %>
        <tr >
        <th colspan="5"></th>
        <th colspan="5">合計</th>
        <th colspan="4">前半</th>
        <th colspan="4">後半</th>
        <th>店舗別</th>
        <th colspan="4">喫茶・カフェ</th>
        <th colspan="4">その他飲食</th>
        <th colspan="4">車屋</th>
        <th colspan="4">その他小売</th>
        <th colspan="4">理容・美容</th>
        <th colspan="4">整体・鍼灸</th>
        <th colspan="4">その他サービス</th>
      <%# キャッシュレス切り返し %>
        <% if @results.where(shift: "キャッシュレス新規").empty? %>
        <% else %>
          <th>キャッシュレス切り返し</th>
          <th colspan="3">どういうこと？</th>
          <th colspan="3">君は誰？協会？</th>
          <th colspan="3">もらうだけでいいの？</th>
          <th colspan="3">PayPayのみ</th>
          <th colspan="3">AirPayのみ</th>
          <th colspan="3">カードのみ</th>
          <th colspan="3">先延ばし</th>
          <th colspan="3">忙しい</th>
          <th colspan="3">現金のみ</th>
          <th colspan="3">面倒くさい</th>
          <th colspan="3">情報不足</th>
          <th colspan="3">ペロ</th>
          <th colspan="3">その他</th>
        <% end %>
      <%# サミット切り返し %>
        <% if @results.where(shift: "サミット").empty? %>
        <% else %>
          <th >サミットNG</th>
          <th ></th>
          <th ></th>
          <th >サミット切り返し</th>
          <th ></th>
          <th ></th>
          <th ></th>
          <th ></th>
          <th ></th>
          <th ></th>
          <th ></th>
          <th ></th>
          <th ></th>
          <th ></th>
          <th ></th>
          <th ></th>
          <th ></th>
          <th ></th>
          <th ></th>
          <th ></th>
          <th ></th>
          <th ></th>
          <th ></th>
          <th ></th>
          <th ></th>
          <th ></th>
          <th ></th>
          <th ></th>
          <th ></th>
          <th ></th>
          <th ></th>
        <% end %>
        
      <%# パンダ切り返し %>
        <% if @results.where(shift: "パンダ").empty? %>
        <% else %>
          <th >パンダ切り返し</th>
          <th colspan="3">結構です</th>
          <th colspan="3">忙しい</th>
          <th colspan="3">検討する</th>
          <th colspan="3">デリバリーはいい</th>
          <th colspan="3">増やしたくない</th>
          <th colspan="3">やる余裕がない</th>
          <th colspan="3">面倒くさい</th>
          <th colspan="3">情報不足</th>
          <th colspan="3">フードネコ</th>
          <th colspan="3">ペロ</th>
          <th colspan="3">その他</th>
        <% end %>
      <%# フェムト切り返し %>
        <% if @results.where(shift: "フェムト").empty? %>
        <% else %>
        <th>フェムト切り返し</th>
          <th colspan="3">忙しい</th>
          <th colspan="3">面倒くさい</th>
          <th colspan="3">置く場所がない</th>
          <th colspan="3">メリットがない</th>
          <th colspan="3">不審</th>
          <th colspan="3">回線使われたくない</th>
          <th colspan="3">結構です</th>
          <th colspan="3">ペロ</th>
          <th colspan="3">その他</th>
        <% end %>
        </tr>
      <%# 大枠基準値（見出し） %>
        <tr >
          <th ></th>
          <th >シフト</th>
          <th >日付</th>
          <th >帯同</th>
          <th >エリア</th>
          <th >売上</th>
          <th >訪問数</th>
          <th >対面数</th>
          <th >フル数</th>
          <th >成約数</th>
          <th >訪問数</th>
          <th >対面数</th>
          <th >フル数</th>
          <th >成約数</th>
          <th >訪問数</th>
          <th >対面数</th>
          <th >フル数</th>
          <th >成約数</th>
      <%# 店舗別基準値（見出し） %>
        <%# 喫茶・カフェ %>
          <th ></th>
          <% 7.times do %>
          <th >訪問数</th>
          <th >対面数</th>
          <th >フル数</th>
          <th >成約数</th>
          <% end %>
      <%# キャッシュレス切り返し（見出し） %>
        <% if @results.where(shift: "キャッシュレス新規").empty? %>
        <% else %>
            <th ></th>
            <% 13.times do %>
            <th >対面数</th>
            <th >フル数</th>
            <th >成約数</th>
            <% end %>
        <% end %>
      <%# サミット切り返し（見出し） %>
        <% if @results.where(shift: "サミット").empty? %>
        <% else %>
        <th >明細なし</th>
        <th >口座なし</th>
        <th >建物一括</th>
        <th >引き落とし拒否</th>
          <th >対面数</th>
          <th >フル数</th>
          <th >成約数</th>
        <th >忙しい</th>
          <th >対面数</th>
          <th >フル数</th>
          <th >成約数</th>
        <th >怪しい</th>
          <th >対面数</th>
          <th >フル数</th>
          <th >成約数</th>
        <th >検討したい</th>
          <th >対面数</th>
          <th >フル数</th>
          <th >成約数</th>
        <th >変えたくない</th>
          <th >対面数</th>
          <th >フル数</th>
          <th >成約数</th>
        <th >その他</th>
          <th >対面数</th>
          <th >フル数</th>
          <th >成約数</th>
        <th >ペロ</th>
          <th >対面数</th>
          <th >フル数</th>
          <th >成約数</th>
        <% end %>
      <%# パンダ切り返し（見出し） %>
        <% if @results.where(shift: "パンダ").empty? %>
        <% else %>
          <th ></th>
          <% 11.times do %>
            <th >対面数</th>
            <th >フル数</th>
            <th >成約数</th>
          <% end %>
        <% end %>
      <%# フェムト切り返し（見出し） %>
        <% if @results.where(shift: "フェムト").empty? %>
        <% else %>
          <th ></th>
          <% 9.times do %>
            <th >対面数</th>
            <th >フル数</th>
            <th >成約数</th>
          <% end %>

        <% end %>
        </tr>
  <% @results.each do |result| %>
      <%# 大枠基準値（値） %>
        <tr>
        <td style="padding: 0 20px;"><%= link_to "編集", edit_result_path(result.id),class: "link" %></td>
        <td ><%= result.shift %></td>
        <td ><%= result.date.month %>月<%= result.date.day %>日</td>
        <td ><%= result.ojt %></td>
        <td ><%= result.area %></td>
        <td ><%= number_with_delimiter(result.profit) %></td>
        <td ><%= result.first_visit + result.latter_visit %></td>
        <td ><%= result.first_interview + result.latter_interview %></td>
        <td ><%= result.first_full_talk + result.latter_full_talk %></td>
        <td ><%= result.first_get + result.latter_get %></td>
      <%#前半%>
        <td ><%= result.first_visit  %></td>
        <td ><%= result.first_interview %></td>
        <td ><%= result.first_full_talk %></td>
        <td ><%= result.first_get %></td>

      <%# 後半 %>
        <td ><%= result.latter_visit %></td>
        <td ><%= result.latter_interview %></td>
        <td ><%= result.latter_full_talk %></td>
        <td ><%= result.latter_get %></td>
        
      <%# 店舗別基準値(値) %>
        <td class="td-blank"></td>
        <%# 喫茶・カフェ %>
          <td ><%= result.cafe_visit %></td>
          <td ><%= result.cafe_interview %></td>
          <td ><%= result.cafe_full_talk %></td>
          <td ><%= result.cafe_get %></td>
        <%#その他飲食%>
          <td ><%= result.other_food_visit %></td>
          <td ><%= result.other_food_interview %></td>
          <td ><%= result.other_food_full_talk %></td>
          <td ><%= result.other_food_get %></td>
        <%#車屋%>
          <td ><%= result.car_visit %></td>
          <td ><%= result.car_interview %></td>
          <td ><%= result.car_full_talk %></td>
          <td ><%= result.car_get %></td>
        <%#その他小売%>
          <td ><%= result.other_retail_visit %></td>
          <td ><%= result.other_retail_interview %></td>
          <td ><%= result.other_retail_full_talk %></td>
          <td ><%= result.other_retail_get %></td>
        <%#理容・美容%>
          <td ><%= result.hair_salon_visit %></td>
          <td ><%= result.hair_salon_interview %></td>
          <td ><%= result.hair_salon_full_talk %></td>
          <td ><%= result.hair_salon_get %></td>
        <%#整体・鍼灸%>
          <td ><%= result.manipulative_visit %></td>
          <td ><%= result.manipulative_interview %></td>
          <td ><%= result.manipulative_full_talk %></td>
          <td ><%= result.manipulative_get %></td>
        <%#その他・サービス%>
          <td ><%= result.other_service_visit %></td>
          <td ><%= result.other_service_interview %></td>
          <td ><%= result.other_service_full_talk %></td>
          <td ><%= result.other_service_get %></td>
      <%# キャッシュレス切り返し %>
        <% if @results.where(shift: "キャッシュレス新規").empty? %>
        <% else %>
        <td class="td-blank"></td>
        <%#どういうこと？%>
        <td ><%= result.cashless_what_interview %></td>
        <td ><%= result.cashless_what_full_talk %></td>
        <td ><%= result.cashless_what_get %></td>
        <%#君は誰？%>
        <td ><%= result.cashless_who_interview %></td>
        <td ><%= result.cashless_who_full_talk %></td>
        <td ><%= result.cashless_who_get %></td>
        <%#もうらだけでいいの？%>
        <td ><%= result.cashless_just_get_interview %></td>
        <td ><%= result.cashless_just_get_full_talk %></td>
        <td ><%= result.cashless_just_get_get %></td>
        <%#PayPayのみ%>
        <td ><%= result.cashless_paypay_only_interview %></td>
        <td ><%= result.cashless_paypay_only_full_talk %></td>
        <td ><%= result.cashless_paypay_only_get %></td>
        <%#AirPayのみ%>
        <td ><%= result.cashless_airpay_only_interview %></td>
        <td ><%= result.cashless_airpay_only_full_talk %></td>
        <td ><%= result.cashless_airpay_only_get %></td>
        <%#カードのみ%>
        <td ><%= result.cashless_card_only_interview %></td>
        <td ><%= result.cashless_card_only_full_talk %></td>
        <td ><%= result.cashless_card_only_get %></td>
        <%#先延ばし%>
        <td ><%= result.cashless_yet_interview %></td>
        <td ><%= result.cashless_yet_full_talk %></td>
        <td ><%= result.cashless_yet_get %></td>
        <%#現金のみ%>
        <td ><%= result.cashless_cash_only_interview %></td>
        <td ><%= result.cashless_cash_only_full_talk %></td>
        <td ><%= result.cashless_cash_only_get %></td>
        <%#忙しい%>
        <td ><%= result.cashless_busy_interview %></td>
        <td ><%= result.cashless_busy_full_talk %></td>
        <td ><%= result.cashless_busy_get %></td>
        <%#面倒くさい%>
        <td ><%= result.cashless_dull_interview %></td>
        <td ><%= result.cashless_dull_full_talk %></td>
        <td ><%= result.cashless_dull_get %></td>
        <%#情報不足%>
        <td ><%= result.cashless_lack_info_interview %></td>
        <td ><%= result.cashless_lack_info_full_talk %></td>
        <td ><%= result.cashless_lack_info_get %></td>
        <%#ペロ%>
        <td ><%= result.cashless_easy_interview %></td>
        <td ><%= result.cashless_easy_full_talk %></td>
        <td ><%= result.cashless_easy_get %></td>
        <%#その他%>
        <td ><%= result.cashless_other_interview %></td>
        <td ><%= result.cashless_other_full_talk %></td>
        <td ><%= result.cashless_other_get %></td>
        <% end %>
      <%# サミット切り返し %>
        <%# NG %>
        <% if @results.where(shift: "サミット").empty? %>
        <% else %>
        <td ><%= result.summit_ng_detail %></td>
        <td ><%= result.summit_ng_cash %></td>
        <td ><%= result.summit_ng_building %></td>
        <td ><%# 引き落とし拒否 %></td>
        <td ><%= result.summit_reject_cash_interview %></td>
        <td ><%= result.summit_reject_cash_full_talk %></td>
        <td ><%= result.summit_reject_cash_get %></td>
        <td ><%# 忙しい %></td>
        <td ><%= result.summit_busy_interview %></td>
        <td ><%= result.summit_busy_full_talk %></td>
        <td ><%= result.summit_busy_get %></td>
        <td ><%# 怪しい %></td>
        <td ><%= result.summit_doubt_interview %></td>
        <td ><%= result.summit_doubt_full_talk %></td>
        <td ><%= result.summit_doubt_get %></td>
        <td ><%# 検討したい %></td>
        <td ><%= result.summit_yet_interview %></td>
        <td ><%= result.summit_yet_full_talk %></td>
        <td ><%= result.summit_yet_get %></td>
        <td ><%# 変えたくない %></td>
        <td ><%= result.summit_not_change_interview %></td>
        <td ><%= result.summit_not_change_full_talk %></td>
        <td ><%= result.summit_not_change_get %></td>
        <td ><%# その他 %></td>
        <td ><%= result.summit_other_interview %></td>
        <td ><%= result.summit_other_full_talk %></td>
        <td ><%= result.summit_other_get %></td>
        <td ><%# ペロ %></td>
        <td ><%= result.summit_easy_interview %></td>
        <td ><%= result.summit_easy_full_talk %></td>
        <td ><%= result.summit_easy_get %></td>
        <% end %>
      <%# パンダ切り返し %>
        <% if @results.where(shift: "パンダ").empty? %>
        <% else %>
          <td class="td-blank"></td>
        <%# 結構です %>
          <td><%= result.panda_not_need_interview %></td>
          <td><%= result.panda_not_need_full_talk %></td>
          <td><%= result.panda_not_need_get %></td>
        <%# 忙しい %>
          <td><%= result.panda_busy_interview %></td>
          <td><%= result.panda_busy_full_talk %></td>
          <td><%= result.panda_busy_get %></td>
        <%# 検討する %>
          <td ><%= result.panda_yet_interview %></td>
          <td ><%= result.panda_yet_full_talk %></td>
          <td ><%= result.panda_yet_get %></td>
        <%# デリバリーはいい %>
          <td ><%= result.panda_not_delivery_interview %></td>
          <td ><%= result.panda_not_delivery_full_talk %></td>
          <td ><%= result.panda_not_delivery_get %></td>
        <%# 増やしたくない %>
          <td ><%= result.panda_not_increment_interview %></td>
          <td ><%= result.panda_not_increment_full_talk %></td>
          <td ><%= result.panda_not_increment_get %></td>
        <%# やる余裕がない %>
          <td ><%= result.panda_not_margin_interview %></td>
          <td ><%= result.panda_not_margin_full_talk %></td>
          <td ><%= result.panda_not_margin_get %></td>
        <%# 面倒くさい%>
          <td ><%= result.panda_dull_interview %></td>
          <td ><%= result.panda_dull_full_talk %></td>
          <td ><%= result.panda_dull_get %></td>
        <%# 情報不足 %>
          <td ><%= result.panda_lack_info_interview %></td>
          <td ><%= result.panda_lack_info_full_talk %></td>
          <td ><%= result.panda_lack_info_get %></td>
        <%# フードネコ %>
          <td ><%= result.panda_food_neko_interview %></td>
          <td ><%= result.panda_food_neko_full_talk %></td>
          <td ><%= result.panda_food_neko_get %></td>
        <%# ペロ %>
          <td ><%= result.panda_easy_interview %></td>
          <td ><%= result.panda_easy_full_talk %></td>
          <td ><%= result.panda_easy_get %></td>
        <%# その他 %>
          <td ><%= result.panda_other_interview %></td>
          <td ><%= result.panda_other_full_talk %></td>
          <td ><%= result.panda_other_get %></td>
        <% end %>
    <%# 楽天フェムト切り返し %>
      <% if @results.where(shift: "フェムト").empty? %>
      <% else %>
      <td class="td-blank"></td>
        <%# 忙しい %>
        <td><%= result.casa_busy_interview %></td>
        <td><%= result.casa_busy_full_talk %></td>
        <td><%= result.casa_busy_get %></td>
        <%# 面倒 %>
        <td><%= result.casa_dull_interview %></td>
        <td><%= result.casa_dull_full_talk %></td>
        <td><%= result.casa_dull_get %></td>
        <%# 置く場所がない %>
        <td><%= result.casa_not_put_space_interview %></td>
        <td><%= result.casa_not_put_space_full_talk %></td>
        <td><%= result.casa_not_put_space_get %></td>
        <%# メリットがない %>
        <td><%= result.casa_no_merit_interview %></td>
        <td><%= result.casa_no_merit_full_talk %></td>
        <td><%= result.casa_no_merit_get %></td>
        <%# 不審 %>
        <td><%= result.casa_distrust_interview %></td>
        <td><%= result.casa_distrust_full_talk %></td>
        <td><%= result.casa_distrust_get %></td>
        <%# 回線を使われたくない %>
        <td><%= result.casa_not_use_net_interview %></td>
        <td><%= result.casa_not_use_net_full_talk %></td>
        <td><%= result.casa_not_use_net_get %></td>
        <%# 結構です %>
        <td><%= result.casa_not_need_interview%></td>
        <td><%= result.casa_not_need_full_talk%></td>
        <td><%= result.casa_not_need_get%></td>
        <%# ぺろ %>
        <td><%= result.casa_easy_interview%></td>
        <td><%= result.casa_easy_full_talk%></td>
        <td><%= result.casa_easy_get%></td>
        <%# その他 %>
        <td><%= result.casa_other_interview %></td>
        <td><%= result.casa_other_full_talk %></td>
        <td><%= result.casa_other_get %></td>
      <% end %>
    <% end %>
    </tr>
  </table>
  <% end %>
<% end %>
</div>